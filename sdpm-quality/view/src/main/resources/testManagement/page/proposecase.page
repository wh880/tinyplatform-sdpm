#import("/org/tinygroup/button/components/button_common.component")
#import("/org/tinygroup/button/components/button.component")
#!set(activeTitle="测试管理",activeMenuId=currentPageId)
<style>
    .select_boxes{margin-top:0}
    .tableBoxes tbody tr{height:30px;}
    .tableBoxes tbody tr td{padding:10px 7px;vertical-align:middle}
</style>


#set(name="qualityCases")
#@div()
    #@tabWithInit("tab_demo" "optionsBox")
        #@div(divClass="dropdownBox")
            #include("/testManagement/page/dropdownMenu.page")
        #end
        #@tabHead()
            #include("/testManagement/page/Tab.page")
        #end

        #@tabBodyCol("ptop-5")
##operationbar start1

#end

    #@tinyForm("thisform" TINY_CONTEXT_PATH+adminPath+"/quality/testCase/save" "post" {"class":"","enctype":"multipart/form-data"})
    #hiddenInput(hiddenInputName="caseId" hiddenInputValue=testCase?.caseId)
    #hiddenInput(hiddenInputName="caseFromBug" hiddenInputValue=bugId)
	<div style="width:100%">
    	<div class="infoContent">
    		<p class="titleName">建用例</p>
        #@elementItem()
            #@colLabel()产品模块：#end
            #@formControlDiv("col-8")
            #@div(divClass="col-5")
					 #@Tselect2F()
                            #@Tselect2Body("productId" testCase?.productId?:qualityProductId {"class":"input-text select2"}) ##,"multiple":"multiple"加上为多选项
                                #for(product : ProductUtils.getAllProductListByUser())
                                <option value="${product?.productId}">${product?.productName}</option>
                                #end
                     #end
                #@Tselect2Fix()
                    <a href="${TINY_CONTEXT_PATH+adminPath}/product/addproduct/addition" class="r ">增加</a>
                    <a href="${TINY_CONTEXT_PATH+adminPath}/product/allproduct/addition">全部</a>#end
                    <script type="text/javascript">
                        $("#${sid}").on("change",function(){
                            var pId = $("#${sid}  option:selected").val();
                            if(pId>0){
                                ajaxRead("${sid}","moduleId","moduleId","moduleName","/quality/testCase/ajax/module?moduleRoot="+pId,${(testCase?.moduleId?:moduleId)?:0},"module");
                            }
                        })
                    </script>
                	  #end

					#end
					#@div(divClass="col-0")&nbsp;&nbsp#end
					#@div(divClass="col-3")
					 #@Tselect2F()
                            #@Tselect2Body("moduleId" testCase?.moduleId?:moduleId {"class":"input-text select2"}) ##,"multiple":"multiple"加上为多选项
	                    	#end
                        <script type="text/javascript">
                            $("#${sid}").on("change",function(){
                                var pId = $("select[name=productId] option:selected").val();
                                var mId = $("#${sid}  option:selected").val();
                                if(pId>0&&mId>0){
                                    ajaxRead("${sid}","storyId","storyId","storyTitle","/quality/testCase/ajax/story?productId="+pId+"&moduleId="+mId,${(testCase?.storyId?:storyId)?:0});
                                }
                            });
                        </script>
                	  #end
					#end
				#end
        #end
        #@elementItem()
            #@colLabel()<span class="c-red">*</span>用例类型：#end
            #@formControlDiv("col-8")
            	#@div(divClass="col-5")
                     #@Tselect2F()
	                   		 #@Tselect2Body("caseType" testCase?.caseType {"class":"input-text select2"}) ##,"multiple":"multiple"加上为多选项
	                   		 #for(type : getDict("caseType"))
	                   		    <option value="${type.value}">${type.text}</option>
	                   		 #end
                     #end
                	  #end
                #end
                    #@validateDiv("col-2")#end
            #end
            #@validateDiv("col-2")#end
        #end
        #@elementItem()
            #@colLabel()<span class="c-red">*</span>试用阶段：#end
            #@formControlDiv("col-8")
               #@div(divClass="col-5")
					 #@Tselect2F()
	                   		 #@Tselect2Body("caseStage" testCase?.caseStage {"class":"input-text select2","multiple":"multiple"}) ##,"multiple":"multiple"加上为多选项
	                       <option value="0"></option>
                         #for(stage : getDict("caseStage"))
                            <option value="${stage.value}">${stage.text}</option>
                         #end
	                    	#end
                	  #end
                #end
            #end
            #@validateDiv("col-2")#end
        #end

        #@elementItem()
            #@colLabel()<span class="c-red">*</span>优先级：#end
            #@formControlDiv("col-8")
                #@div(divClass="col-5")
					#@tinySelect("priority" testCase?.priority {"class":"select2"})
                        #for(stage : getDict("casePriority"))
                        <option value="${stage.value}">${stage.text}</option>
                    #end
					#end
                #end
            #end
            #@validateDiv("col-2")#end
        #end

        #@elementItem()
            #@colLabel()相关需求：#end
            #@formControlDiv("col-8")
					#@div(divClass="col-5")
                        #@Tselect2F()
	                   		 #@Tselect2Body("storyId" testCase?.storyId?:storyId {"class":"input-text select2"}) ##,"multiple":"multiple"加上为多选项

                             #end
                            #@Tselect2Fix()

                                <a href="${TINY_CONTEXT_PATH+adminPath}/product/story/addstory" class="r ">增加</a>
                                <a href="${TINY_CONTEXT_PATH+adminPath}/product/story?choose=1">全部</a>
                        #end
                            <script type="text/javascript">
                                $(document).ready(function(){
                                    var pId = $("select[name=productId]  option:selected").val();
                                    if(pId>0){
                                        ajaxRead("${sid}","storyId","storyId","storyTitle","/quality/testCase/ajax/story?productId="+pId,${case?.storyId?:0});
                                    }
                                });
                            </script>
                        #end
					#end
			#end
        #end
        #@elementItem()
            #@colLabel()<span class="c-red">*</span>用例标题：#end
            #@formControlDiv("col-8")
            #@div(divClass="col-5")
                #tinyInput("text" "caseTitle" testCase?.caseTitle {"datatype":"*10-500","id":"版本","class":"input-text"})
            #end
            #end
            #@validateDiv("col-2")#end
        #end
        #@elementItem()
            #@colLabel()前置条件：#end
            #@formControlDiv("col-8")
                #@tinyTextarea("casePrecondition" {"placeholder":""})#end
            #end
            #@validateDiv("col-2")#end
        #end
        ##暂留、、、、、、、、、、、、、、、、、
       #@elementItem()
               	#@colLabel("col-2")用例步骤：#end
               	<div class="col-8">
             		   #include("/testManagement/page/caseStepAdd.page")
                   </div>
               #end
        #@elementItem()
            #@colLabel()关键词：#end
            #@formControlDiv("col-8")
            	#@div(divClass="col-5")
                	#tinyInput("text" "caseKeywords" testCase?.caseKeywords {"datatype":"","id":"关键词","class":"input-text"})
            	#end
            #end
            #@validateDiv("col-2")#end
        #end
        #@elementItem()
            #@colLabel()附件：#end
            #@formControlDiv("col-8")
                #include("/testManagement/page/fileupload.page")
            #end
            #@validateDiv("col-2")#end
        #end
       #@elementItem()
        <div class="col-12">
            <div class="col-5">

            </div>
            <div class="col-1">
                <button style="float: left" type="submit" id="submit" class="commitBtn">保存</button>
            </div>
            <div class="col-1">
                #@aExtendButton("btn-sm backBtn" "javascript:history.go(-1)")返回#end
            </div>
            <div class="col-5"></div>
        </div>
    #end
    <br>
    #end
    </div>
   </div>

<script type="text/javascript">


	function ajaxRead(id,toName,opKey,opvalue,url,value,isBuild){
    		var selectCheck = "select[name="+toName+"]";
    		$(selectCheck).each(function(){
    			var sele = $(this);
    			var s;
    			$.ajax({
    				type: "POST",
    				url: "${TINY_CONTEXT_PATH+adminPath}"+url,
    				data: $(this).attr('data'),
    				dataType:"json",
    				success: function(data){
    					sele.empty();
                        var em;
    					if("build"==(isBuild)){
    					 em = "<option value='0' selected  >trunk</option>";
    					}else if("module"==isBuild){
    					 em = "<option value='0' selected  >/</option>";
    					}
    					sele.append(em);
    					for(var i=0,l=data.length;i<l;i++){
    						var em = "<option value='"+data[i][opKey]+"' >"+ data[i][opvalue] +"</option>";
    						sele.append(em);

    					}

    					if(value!=null) {
    						sele.val(value).trigger("change");
    					}else {
    						sele.val(data[0][opKey]).trigger("change");
    					}


    				},
    				error: function(res){

    				}
    			});


    		});

    	}
</script>

#end
#end