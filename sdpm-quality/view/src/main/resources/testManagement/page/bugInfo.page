#import("/org/tinygroup/button/components/button_common.component")
#import("/org/tinygroup/button/components/button.component")
#import("/org/tinygroup/table/components/table.component")
#import("/org/tinygroup/button/components/button_smart.component")
#!set(activeTitle="测试管理",activeMenuId=currentPageId)
<style>
    .select_boxes {
        margin-top: 0
    }
    #*    .margin-top {margin-top:8px;float:left;margin-left:18px}*#
</style>


#set(name="qualityBug")
#@div()
    #@tabWithInit("tab_demo" "optionsBox")
        #@div(divClass="dropdownBox")
            #include("/testManagement/page/dropdownMenu.page")
        #end
        #@tabHead()
            #include("/testManagement/page/Tab.page")
        #end

        #@tabBodyCol("ptop-5")
        #end
    #end
#end
##operationbar start1
#@div()
    #@p(pClass="title_sty")
    <span class="f">
			Bug概况</span>
    <span class="r">
        #foreach(m:menuManager.getScopeMenus("testbuginfo-tab"))
            #if(m.id=="tmakesure")
                #if(qualityBug?.bugConfirmed==1)
                    <span style="color:grey">#buttonIcon(iconClass=m.icon+" grey")</span>&nbsp;&nbsp;
                #else
                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?bugId=${qualityBug?.bugId}"
                       title="${m.name}">#buttonIcon(iconClass=m.icon)</a>&nbsp;&nbsp;
                #end
            #elseif(m.id=="tassign")
                #if(qualityBug?.bugConfirmed==1)
                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?bugId=${qualityBug?.bugId}"
                       title="${m.name}">#buttonIcon(iconClass=m.icon)</a>
                #else
                    <span style="color:grey">#buttonIcon(iconClass=m.icon+" grey")</span>&nbsp;&nbsp;
                #end
            #elseif(m.id=="tsolution")
                #if(qualityBug?.bugStatus=="1"&&qualityBug?.bugConfirmed==1)
                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?bugId=${qualityBug?.bugId}"
                       title="${m.name}">#buttonIcon(iconClass=m.icon)</a>&nbsp;&nbsp;
                #else
                    <span style="color:grey">#buttonIcon(iconClass=m.icon+" grey")</span>&nbsp;&nbsp;
                #end
            #elseif(m.id=="tbugadddemand")
                #if(qualityBug?.bugStatus!="3")
                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?bugId=${qualityBug?.bugId}"
                       title="${m.name}">#buttonIcon(iconClass=m.icon)</a>&nbsp;&nbsp;
                #end
            #elseif(m.id=="reActive")
                #if(qualityBug?.bugStatus=="3")
                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?bugId=${qualityBug?.bugId}"
                       title="${m.name}">#buttonIcon(iconClass=m.icon)</a>&nbsp;&nbsp;
                #end
            #elseif(m.id=="add-case")
                <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?bugId=${qualityBug?.bugId}"
                   title="${m.name}">#buttonIcon(iconClass=m.icon)</a>&nbsp;&nbsp;
            #end
        #end
        #foreach(m:menuManager.getScopeMenus("testbuginfo-tab"))

            #if(m.id=="tedition"||m.id=="tproposeBug"||m.id=="tbugback")
                <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?bugId=${qualityBug?.bugId}" title="${m.name}">
                    #buttonIcon(iconClass=m.icon)</a>&nbsp;&nbsp;
            #elseif(m.id=="tbugremark")
                <a title="备注" onclick="toggle()">
                    #buttonIcon(iconClass="icon-comment-alt")</a>&nbsp;&nbsp;
            #elseif(m.id=="tbugdelete")
                <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?bugId=${qualityBug?.bugId}" title="${m.name}">
                    #buttonIcon(iconClass=m.icon)</a>&nbsp;&nbsp;
            #elseif(m.id=="tbugnext")
                #if(nextId<1)
                    <span style="color:grey">#buttonIcon(iconClass=m.icon+" grey")</span>&nbsp;&nbsp;
                #else
                    <a href="${TINY_CONTEXT_PATH+adminPath}/quality/bug/bugInfo?currentPageId=5&bugId=${nextId}"
                       title="${m.name}">#buttonIcon(iconClass=m.icon)</a>&nbsp;&nbsp;
                #end
            #end
        #end
        <a href="javascript :;" onClick="javascript :history.back(-1);" title="返回">#buttonIcon(iconClass=
            "icon-reply")</a>
    #end
    #@tinyForm(
        "thisform" TINY_CONTEXT_PATH+adminPath+"/quality/bug/addComment?bugId="+qualityBug?.bugId "post" {"class":""})
        <script type="text/javascript">
            $("#${fromId}").submit(function () {
                var url = $(this).attr('action');
                $.ajax({
                    type: "POST",
                    url: url,
                    data: $("#${fromId}").serialize(),// 你的formid
                    async: false,
                    error: function (request) {
                        alert("Connection error");
                    },
                    success: function (data) {
                        if (data.status == "success") {
                            window.location.reload();
                        }
                        ;
                    }
                });
                return false;
            });

        </script>
        <div style="width:70%;float:left" class="pageleftpart">
            <div class="infoContent">
                <p class="titleName">重现步骤</p>
                ${qualityBug?.bugSteps}
            </div>
            <div class="infoContent">
                <p class="titleName">附件</p>
                #foreach(f:file)
                    #set(path=f?.filePathname)
                    <a href="${TINY_CONTEXT_PATH+path}">${f?.fileTitle}.${f?.fileExtension}</a>&nbsp&nbsp&nbsp&nbsp
                    #foreach(m:menuManager.getScopeMenus("product-file-op"))
                        #if(m.id == "story-file-edit")
                            #@aModal("#myModal" m.name "400" "120" "class-m" adminPath+m.href+"?fileId="+f?.fileId)
                                #buttonIcon(iconClass=m.icon)#end&nbsp&nbsp&nbsp

                        #else
                            #@delItemsdpm(TINY_CONTEXT_PATH+adminPath+m.href f?.fileId )
                                #buttonIcon(iconClass=m.icon)
                            #end
                        #end
                    #end <br>
                #end

            </div>
            #history(adminPath+"/system/action/ajax/history?actionObjectType=bug&actionObjectId="+qualityBug?.bugId)
            <center>
                #foreach(m:menuManager.getScopeMenus("testbuginfo-tab"))
                    #if(m.id=="tmakesure")
                        #if(qualityBug?.bugConfirmed==1)
                            <span style="color:grey">#buttonIcon(iconClass=m.icon+" grey")</span>&nbsp;&nbsp;
                        #else
                            <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?bugId=${qualityBug?.bugId}"
                               title="${m.name}">#buttonIcon(iconClass=m.icon)</a>&nbsp;&nbsp;
                        #end
                    #elseif(m.id=="tassign")
                        #if(qualityBug?.bugConfirmed==1)
                            <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?bugId=${qualityBug?.bugId}"
                               title="${m.name}">#buttonIcon(iconClass=m.icon)</a>
                        #else
                            <span style="color:grey">#buttonIcon(iconClass=m.icon+" grey")</span>&nbsp;&nbsp;
                        #end
                    #elseif(m.id=="tsolution")
                        #if(qualityBug?.bugStatus=="1"&&qualityBug?.bugConfirmed==1)
                            <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?bugId=${qualityBug?.bugId}"
                               title="${m.name}">#buttonIcon(iconClass=m.icon)</a>&nbsp;&nbsp;
                        #else
                            <span style="color:grey">#buttonIcon(iconClass=m.icon+" grey")</span>&nbsp;&nbsp;
                        #end
                    #elseif(m.id=="tbugadddemand")
                        #if(qualityBug?.bugStatus!="3")
                            <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?bugId=${qualityBug?.bugId}"
                               title="${m.name}">#buttonIcon(iconClass=m.icon)</a>&nbsp;&nbsp;
                        #end
                    #elseif(m.id=="reActive")
                        #if(qualityBug?.bugStatus=="3")
                            <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?bugId=${qualityBug?.bugId}"
                               title="${m.name}">#buttonIcon(iconClass=m.icon)</a>&nbsp;&nbsp;
                        #end
                    #elseif(m.id=="add-case")
                        <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?bugId=${qualityBug?.bugId}"
                           title="${m.name}">#buttonIcon(iconClass=m.icon)</a>&nbsp;&nbsp;
                    #end

                #end
                #foreach(m:menuManager.getScopeMenus("testbuginfo-tab"))

                    #if(m.id=="tedition"||m.id=="tproposeBug"||m.id=="tbugback")
                        <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?bugId=${qualityBug?.bugId}" title="${m.name}">
                            #buttonIcon(iconClass=m.icon)</a>&nbsp;&nbsp;
                    #elseif(m.id=="tbugremark")
                        <a title="备注" onclick="toggle()">
                            #buttonIcon(iconClass="icon-comment-alt")</a>&nbsp;&nbsp;
                    #elseif(m.id=="tbugdelete")
                        <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?bugId=${qualityBug?.bugId}" title="${m.name}">
                            #buttonIcon(iconClass=m.icon)</a>&nbsp;&nbsp;
                    #elseif(m.id=="tbugnext")
                        #if(nextId<1)
                            <span style="color:grey">#buttonIcon(iconClass=m.icon+" grey")</span>&nbsp;&nbsp;
                        #else
                            <a href="${TINY_CONTEXT_PATH+adminPath}/quality/bug/bugInfo?currentPageId=5&bugId=${nextId}"
                               title="${m.name}">#buttonIcon(iconClass=m.icon)</a>&nbsp;&nbsp;
                        #end
                    #end
                #end
                <a href="javascript :;" onClick="javascript :history.back(-1);" title="返回">#buttonIcon(iconClass=
                    "icon-reply")</a>
            </center>
            #@div(divId="comment" divStyle="display:none;" divClass="infoContent")
                <p class="titleName">备注</p>
                #@Teditor("content1" "content1" {"initialFrameHeight":"150"})#end
                #@elementItem()
                    <div class="col-12">
                        <div class="col-5">
                            <button style="float: right" type="submit" id="submit" class="commitBtn">保存</button>
                        </div>
                        <div class="col-1"></div>
                        <div class="col-1">
                            #@aExtendButton("btn-sm backBtn" "javascript:history.go(-1)")返回#end

                        </div>
                        <div class="col-5"></div>
                    </div>
                #end
            #end
        </div>
    #end
    <div style="width: 30%;float: right">
        #TypeInfo("qualityBugInfo",qualityBug?.bugId)

    </div>
#end

#@dialog("myModal")
    #@dialogHeader()对话框标题#end
    #@dialogBody()<p>对话框内容…</p>#end
    #@dialogFooter()
    #end
#end
    <script type="text/javascript">
        function toggle() {
            var comment = document.getElementById("comment");
            if (comment.style.display == 'none')
                comment.style.display = 'block';
            else
                comment.style.display = 'none';
        }

    </script>

