#!set(activeTitle="测试管理",activeMenuId=currentPageId)
#set(count="")
#set(name="qualityVersion")
#macro linkOperation(operation doActionUrl map)<span id="${operation}-${tableId}">#bodyContent</span><script type="text/javascript">
 $(function(){
  $("#${operation}-${tableId}").on("click",function() {
		layer.confirm("请确认?",function() {
			 var checklist = [];
			 var versions = [];
			 $("#${tableId} input[name=idCheck]:checked").each(function (e) {
			   // var str = $(this).val().split(",");
				  checklist.push($(this).val());
				  var v_val=$(this).closest("tr").find("select:first").val();
				  versions.push(v_val);
			 });
			 if(checklist.length==0){
				layer.msg("请选择记录")
				 return false;
			 }
			 $.ajax({
				  url: "${doActionUrl}",
				  data: {ids: checklist,ves:versions, action: "${operation}"#mapToJson(map)},
				  dataType: "json",
				  traditional:true,
				  success: function (data) {
						if (data.status=="success"||data.status=="y") {
							  location.href = "${TINY_CONTEXT_PATH+adminPath+"/quality/version/taskToCase?testversionId="+testversionId+"&currentPageId=5&status=tverallcase"}";
						}else{
							 layer.msg(data.info);
						}
				  },
				  error:function(){
					  layer.msg("系统出错，请确认你的请求地址");
				  }
			 })
		});
		//return false;
  })
 });
</script>#end
#@div()
	#@tabWithInit("tab_demo" "optionsBox")
			#@div(divClass="dropdownBox")
				#include("/testManagement/page/dropdownMenu.page")
			#end
			#@tabHead()
				#include("/testManagement/page/Tab.page")
			#end
			
			#@tabBodyCol("ptop-5")
			##operationbar start1
			#@div(divClass="operationbar")
				<span class="f">
					<a href="${TINY_CONTEXT_PATH+adminPath}/testManagement/page/versionSituation.page" class="active_btn">版本名称</a> >关联用例
					<a href="#" id="showsearchmore">#buttonIcon(iconClass="icon-search")搜索</a>
				</span>
				<span class="r">

					<a href="${TINY_CONTEXT_PATH+adminPath}/testManagement/page/versionLink.page">#buttonIcon(iconClass="icon-link")按需求关联</a>&nbsp;
					<a href="${TINY_CONTEXT_PATH+adminPath}/testManagement/page/versionLink.page">#buttonIcon(iconClass="icon-link")按Bug关联</a>&nbsp;
					<a id="back" href="javascript:void(0);" title="返回">#buttonIcon(iconClass="icon-reply")
					<script type="text/javascript">
                        $(function(){
                            $("#back").on("click",function(){
                               window.location.href=document.referrer;
                            });
                        })
                    </script>
					</a>
					</span>
				#div(divClass="clearfix")
				#include("/testManagement/page/mulsearch.page")
			#end
			##operationbar end
			#end
			##tabbody end
			#@tinyTable()
				#@div(divBaseClass="tinyheaderTools form-inline")
					#setTinyTablePageSize([10,20,50,100,200,35]) ##每页数据条数设置
					<div class="f col-2">
						<input type="button" value="全选" class="btn btn-default btn-primary col-3" 
						onclick="selectAllNullorReserve('idCheck','全选');" />
						<div class="col-0">&nbsp&nbsp</div>
						<input type="button" value="反选" class="btn btn-default btn-primary col-3"
						 onclick="selectAllNullorReserve('idCheck','反选');" />
						<div class="col-0">&nbsp&nbsp</div>
						<div class="dropdown col-3">
							#@linkOperation("link" TINY_CONTEXT_PATH+adminPath+"/quality/version/makeLink?testversionId="+testversionId)
							<div><input type="button" value="保存" class="btn btn-default btn-primary" /></div>
							#end
						</div>
					</div>
				#end
				<div class="infoContent">
				    <p class="titleName"><</p>
			#set(requestStatusString = tinyRequestQueryString!=null ?"?"+tinyRequestQueryString:"")
			#@tinyTableContent(TINY_CONTEXT_PATH+adminPath+"/quality/version/link"+requestStatusString)
				#@thead()
					#@tr()
						#@tinyTh({"width":"6"})<input type="checkbox" name="userid" value="">#end
						#@tinyTh({"class":"sorting","rel":"caseId"})ID#end
						#@tinyTh({"class":"sorting","rel":"caseVersion"})版本#end
						#@tinyTh({"class":"sorting","rel":"priority"})P#end
						#@tinyTh({"class":"sorting","rel":"caseTitle"})用例标题#end
						#@tinyTh({"class":"sorting","rel":"caseType","style":"color:#333"})用例类型#end
						#@tinyTh({"class":"sorting","rel":"caseOpenedBy"})创建#end
						#@tinyTh({"class":"sorting","rel":"caseStatus"})状态#end
					#end
				#end
				<script type="text/javascript">
				$(function(){
					$('#${tableId}').on('click','.delBtn',function(e){
						user_del(this,'1');
					});
				})
			</script>
				#@dialog("myModal")
					#@dialogHeader()对话框标题#end
					#@dialogBody()<p>对话框内容…</p>#end
					#@dialogFooter()
						#@buttonEnsure()确定#end
						#@buttonCancel()关闭#end
					#end
				#end
			#end
			#end
		</div>
	#end
#end
<script type="text/javascript">
function selectAllNullorReserve(obj,type){
   if(obj!=null&&obj!=""){
    if(document.getElementsByName(obj)!=undefined&&document.getElementsByName(obj).length>0){	//getElementsByName函数的作用按名字查找对象，返回一个数组。
     var userids = document.getElementsByName(obj);
     if(type=="全选"){
      for(var i=0;i<userids.length;i++){
       if(userids[i].checked == false){
        userids[i].checked = true;
       }
      }
     }else if(type=="全不选"){
      for(var i=0;i<userids.length;i++){
       if(userids[i].checked == true){
        userids[i].checked = false;
       }
      }
     }else if(type=="反选"){
      for(var i=0;i<userids.length;i++){
       if(userids[i].checked == true){
        userids[i].checked = false;
       }else{
        userids[i].checked = true;
       }
      }
     }
    }
   }  
}
</script>