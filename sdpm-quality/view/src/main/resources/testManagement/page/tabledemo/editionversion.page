#import("/org/tinygroup/button/components/button_common.component")
#import("/org/tinygroup/button/components/button.component")
#import("/org/tinygroup/table/components/table.component")

#!set(activeTitle="测试管理",activeMenuId=currentPageId)
<style>
    .select_boxes{margin-top:0}
</style>
<script type="text/javascript">
    function ajaxRead(id,toName,opKey,opvalue,url,value,isBuild){
        var selectCheck = "select[name="+toName+"]";
        $(selectCheck).each(function(){
            var sele = $(this);
            var s;
            $.ajax({
                type: "POST",
                url: "${TINY_CONTEXT_PATH+adminPath}"+url,
                data: $(this).attr('data'),
                dataType:"json",
                success: function(data){
                    sele.empty();
                    var em;
                    if("build"==(isBuild)){
                        em = "<option value='0' selected  >trunk</option>";
                    }else if("module"==isBuild){
                        em = "<option value='0' selected  >/</option>";
                    }
                    sele.append(em);
                    for(var i=0,l=data.length;i<l;i++){
                        var em = "<option value='"+data[i][opKey]+"' >"+ data[i][opvalue] +"</option>";
                        sele.append(em);

                    }

                    if(value!=null) {
                        sele.val(value).trigger("change");
                    }else {
                        sele.val(data[0][opKey]).trigger("change");
                    }


                },
                error: function(res){
//                    alert("失败");
                }
            });


        });

    }
</script>

#set(name="qualityVersion")
#@div()
#@tabWithInit("tab_demo" "optionsBox")
	#@div(divClass="dropdownBox")
		#include("/testManagement/page/dropdownMenu.page")
	#end
	#@tabHead()
		#include("/testManagement/page/Tab.page")
	#end

	#@tabBodyCol("ptop-5")
##operationbar start1

#end
		#@tinyForm("thisform" TINY_CONTEXT_PATH+adminPath+"/quality/version/save" "post" {"class":"test"})
		<script type="text/javascript">
            $(function(){
                var form = $("#${fromId}");
                var action = form.attr("action");
                form.submit(function(){
                    $.ajax({
                         type: "post",
                         url: action,
                         data: form.serialize(),
                         dataType: "json",
                         success: function(data){
                                if(data.status == "y"){
                                window.location.href=document.referrer;
                                }
                            }
                             });
                             return false;
                });
            })

        </script>
		#hiddenInput(hiddenInputName="testversionId" hiddenInputValue=testTask?.testversionId)
			<div style="width:100%">
    			<div class="infoContent">
    				<p class="titleName">编辑版本</p>
			#@elementItem()
				#@colLabel()<span class="c-red">*</span>所属项目：#end
				#@formControlDiv("col-8")
					#@div(divClass="col-5")
					 #@Tselect2F()
	                   		 #@Tselect2Body("projectId" testTask?.projectId?:0 {"class":"input-text select2"}) ##,"multiple":"multiple"加上为多选项

	                    	#end
                           <script type="text/javascript">
                               ajaxRead("${sid}", "projectId", "projectId", "projectName", "/quality/bug/ajax/project?productId=${qualityProductId}", "${testTask?.projectId?:(projectId?:0)}");
                                $("#${sid}").on("change",function(){
                                    var pId = $("#${sid}  option:selected").val();
									if(pId>0){
										ajaxRead("${sid}","buildName","buildId","buildName","/quality/version/ajax/build?buildProject="+pId+"&buildProduct=${qualityProductId?:0}",${testTask?.buildName?:0},"build");
										ajaxRead("${sid}","testtaskOwner","orgUserId","orgUserRealName","/quality/version/ajax/user?projectId="+pId,"${testTask?.testtaskOwner?:0}");
									}
                                })
                            </script>
						#@Tselect2Fix()
							#@hasMenu("project-op-add")
                                <a href="${TINY_CONTEXT_PATH+adminPath}/project/form" class="r">增加</a>
							#end
							#@hasMenu("project-op-all")
                                <a href="${TINY_CONTEXT_PATH+adminPath}/project/list">全部</a>
							#end
						#end
                	  #end
                	 #end
					#@validateDiv("col-2")#end
					#end
			#end
			#@elementItem()
				#@colLabel()<span class="c-red">*</span>版本：#end
				#@formControlDiv("col-8")
					#@div(divClass="col-5")
					 #@Tselect2F()
	                   		 #@Tselect2Body("buildName" testTask?.buildName?:0 {"class":"input-text select2"}) ##,"multiple":"multiple"加上为多选项

	                    	#end
						 #@Tselect2Fix()
							 #@hasMenu("pro-version-add")
                                 <a href="${TINY_CONTEXT_PATH+adminPath}/project/build/edit" class="r ">增加</a>
							 #end
							 #@hasMenu("version")
                                 <a href="${TINY_CONTEXT_PATH+adminPath}/project/build/index">全部</a>
							 #end
						 #end
                	  #end
                	 #end
					#@validateDiv("col-2")#end
					#end
			#end

			#@elementItem()
				#@colLabel()负责人：#end
				#@formControlDiv("col-8")
					#@div(divClass="col-5")
					 #@Tselect2F()
	                   		 #@Tselect2Body("testtaskOwner" testTask?.testtaskOwner?:0 {"class":"input-text select2"}) ##,"multiple":"multiple"加上为多选项

	                    	#end
						 #@Tselect2Fix()
							 #@hasMenu("organizationAddUser")
                                 <a href="${TINY_CONTEXT_PATH}/a/org/user/form">增加</a>
							 #end
							 #@hasMenu("organizationUser")
                                 <a href="${TINY_CONTEXT_PATH}/a/org/user/list" class="r">全部</a>
							 #end
						 #end
                	  #end
                	 #end
					#@validateDiv("col-2")#end

				#end
				#@validateDiv("col-2")#end
			#end

			#@elementItem()
				#@colLabel()优先级：#end
				#@formControlDiv("col-8")
					#@div(divClass="col-5")
	                        #@Tselect2F()
	                   		 #@Tselect2Body("priority" testTask?.priority {"class":"input-text select2"}) ##,"multiple":"multiple"加上为多选项
	                        #for(pri : getDict("versionPriority"))
	                             <option value="${pri?.value}">${pri?.text}</option>
	                        #end
	                    	#end                	                    
                	  #end
	                #end
	              #end
				#@validateDiv("col-2")#end
			#end
				#@elementItem()
					#@colLabel()<span class="c-red">*</span>开始日期：#end
					#@formControlDiv("col-8")
						#@div(divClass="col-5")
						#@tinyDateInput("testtaskBegin" testTask?.testtaskBegin "YYYY-MM-DD" {"datatype":"*","nullmsg":"日期不能为空"})#end
						#end
					#end
					#@validateDiv("col-2")#end
				#end
				#@elementItem()
					#@colLabel()<span class="c-red">*</span>结束日期：#end
					#@formControlDiv("col-8")
						#@div(divClass="col-5")
						#@tinyDateInput("testtaskEnd" testTask?.testtaskEnd "YYYY-MM-DD" {"datatype":"*","nullmsg":"日期不能为空"})#end
						#end					#end
					#@validateDiv("col-2")#end
				#end

			#@elementItem()
				#@colLabel()当前状态：#end
				#@formControlDiv("col-8")
					#@div(divClass="col-5")
					#@tinySelect("testtaskStatus" testTask?.testtaskStatus {"class":"#####","nullmsg":"请选择","datatype":""})
					#for(status : getDict("versionStatus"))
						#@optionItem(status?.value)${status?.text}#end
					#end
					#end
					#end
				#end
				#@validateDiv("col-2")#end
			#end
			#@elementItem()
				#@colLabel()任务名称：#end
				#@formControlDiv("col-8")
					#@div(divClass="col-5")
						#tinyInput("text" "testtaskTitle" testTask?.testtaskTitle {"datatype":"*","id":"抄送给","class":"input-text"})
					#end					
				#end
				#@validateDiv("col-2")#end
			#end

			#@elementItem()
				#@colLabel()描述：#end
				#@formControlDiv("col-8")
					#@Teditor("content" "testtaskDesc" {"initialFrameHeight":"150"})${testTask?.testtaskDesc}#end

				#end
				#@validateDiv("col-2")#end
			#end
			#@elementItem()
				#@colLabel()测试总结：#end
				#@formControlDiv("col-8")
					#@Teditor("content1" "testtaskReport" {"initialFrameHeight":"150"})${testTask?.testtaskReport}#end

				#end
				#@validateDiv("col-2")#end
			#end
			<br>
			#@elementItem()
		        <div class="col-12">
		            <div class="col-5">
		
		            </div>
		            <div class="col-1">
		                <button style="float: left" type="submit" id="submit" class="commitBtn">保存</button>
		            </div>
		            <div class="col-1">
		                #@aExtendButton("btn-sm backBtn" "javascript:history.go(-1)")返回#end
		            </div>
		            <div class="col-5"></div>
		        </div>
    		#end
    	</div>
    </div>
	#end
	#end
	#end


