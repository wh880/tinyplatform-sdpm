#import("/org/tinygroup/form/components/form.component")
#import("/org/tinygroup/button/components/button_smart.component")
#import("/org/tinygroup/button/components/button_common.component")
#import("/org/tinygroup/button/components/button.component")
#import("/org/tinygroup/fold/components/fold.component")
#!set(activeTitle="测试管理",activeMenuId=currentPageId)

#set(name="qualityBug")
#@div()
	#@tabWithInit("tab_demo" "optionsBox")
			#@div(divClass="dropdownBox")
				#include("/testManagement/page/dropdownMenu.page")
			#end
			#@tabHead()
				#include("/testManagement/page/Tab.page")
			#end
			
			#@tabBodyCol("ptop-5")
			##operationbar star
			#@div(divClass="operationbar")
				<span class="f">
#*					<a href="#" class="active_btn">未关闭</a>*#
					<a href="${TINY_CONTEXT_PATH}/testManagement/page/Bug.page" class="active_btn">未关闭</a>
					<a href="${TINY_CONTEXT_PATH}/testManagement/page/Bug.page">所有</a>
					<a href="${TINY_CONTEXT_PATH}/testManagement/page/Bug.page">指派给我</a>
					<a href="${TINY_CONTEXT_PATH}/testManagement/page/Bug.page">由我创建</a>
					<a href="${TINY_CONTEXT_PATH}/testManagement/page/Bug.page">由我解决</a>
					<a href="${TINY_CONTEXT_PATH}/testManagement/page/Bug.page">未确认</a>
					<a href="${TINY_CONTEXT_PATH}/testManagement/page/Bug.page">未指派</a>
					<a href="${TINY_CONTEXT_PATH}/testManagement/page/Bug.page">未解决</a>
					<a href="${TINY_CONTEXT_PATH}/testManagement/page/Bug.page">久未处理</a>
					<a href="${TINY_CONTEXT_PATH}/testManagement/page/Bug.page">被延期</a>
					<a href="${TINY_CONTEXT_PATH}/testManagement/page/Bug.page">需求变动</a>
					<a href="#" id="showsearchmore">#buttonIcon(iconClass="icon-search")搜索</a>
				</span>
				<span class="r">
					#@iconOperations("#myModal" "icon-download-alt" "导入" "500" "100" "/testManagement/page/tabledemo/importBug.pagelet" "ml-5")&nbsp导入#end
					
					###@iconOperations("#myModal" "icon-download-alt" "导出" "865" "448" "/page/tabledemo/user-add.pagelet" "ml-5")&nbsp导出#end	
				    #@buttonGroup()			   		
	                    #@buttonDropdown("Dropdown") #buttonIcon(iconClass="icon-upload-alt")导出   #@spanCaret()#end#end
	                    #@ulDropdownMenu("downMenuSty")
#*	                    	#@iconOperations("#myModal" "icon-download-alt" "导出数据" "865" "200"
						 "/page/tabledemo/user-add.pagelet" "ml-5")导出数据#end*#
						 #@aModal("#myModal" "导出数据" "500" "100" "" "/testManagement/page/tabledemo/exportBugData.pagelet")导出数据#end
						</br>
						 #@aModal("#myModal" "导出模板" "500" "100" "" "/testManagement/page/tabledemo/exportBugTemplet.pagelet")导出模版#end
							#@dialog("myModal")
								#@dialogHeader()对话框标题#end
								#@dialogBody()<p>对话框内容…</p>#end
								#@dialogFooter()
									#@buttonEnsure()确定#end
								    #@buttonCancel()关闭#end
							  	#end
							#end
						#end
						
                    #end&nbsp;
                    
					<a href="${TINY_CONTEXT_PATH}/testManagement/page/reportform.page">#buttonIcon(iconClass="icon-plus-sign")报表</a>&nbsp;
                    <a href="${TINY_CONTEXT_PATH}/testManagement/page/BatchAdding.page">#buttonIcon(iconClass="icon-plus-sign")批量添加</a>&nbsp;
					<a href="${TINY_CONTEXT_PATH}/testManagement/page/proposeBug.page">#buttonIcon(iconClass="icon-plus")建Bug</a>
				</span>
				#div(divClass="clearfix")
				#include("/testManagement/page/mulsearch.page")
			#end
		#end
	#end
#end
			
#@tinyForm("thisform" "" "" {"class":"test"})
	<div style="width:67%;float:left">
    	<div class="infoContent">
    		<p class="titleName"><a href="${TINY_CONTEXT_PATH}/testManagement/page/Bug.page">项目1</a> >确认</p>
    		<div class="RTtitle">
            	<button type="submit" id="submit" class="commitBtn">保存</button>
        	</div>
    #@elementItem()
            #@sdpmItem("指派给")
	            #@tinySelect("" "1" {"class":"#####","nullmsg":"请选择","datatype":"*"})
	               		#@optionItem("1")--请选择--#end
	               		#@optionItem("2")admin#end
	               		#@optionItem("3")demo#end
	            #end	             
        	#end
    #end
    #@elementItem()
    	#@sdpmItem("优先级")
                #@tinySelect("" "1" {"class":"#####","nullmsg":"请选择","datatype":"*"})
                    #@optionItem("1")/#end
                    #@optionItem("2")1#end
	               	#@optionItem("3")2#end
	               	#@optionItem("3")3#end	
                #end
   		#end 
    #end
    #@elementItem()
        #@sdpmItem("抄送给")
            #tinyInput("text" "抄送给" ""{"datatype":"","id":"抄送给","class":"input-text"})
        #end
    #end

    #@elementItem()
            <div class="col-12">
                <div class="col-2 text-r"><label>备注：</label></div>

                <div class="col-9">
                    #@Teditor("content" "content" {"initialFrameHeight":"150"})Say something#end</div>
            </div>
        #end
        <br/>
       </div>
    #@elementItem()
        <div class="col-12">
            <div class="col-5">
                <button style="float: right" type="submit" id="submit" class="commitBtn">保存</button>
            </div>
            <div class="col-1"></div>
            <div class="col-1">
                <a href="${TINY_CONTEXT_PATH}/testManagement/page/Bug.page">
                <button style="float: left" type="button" id="back" class="backBtn">返回</button></a>
            </div>
            <div class="col-5"></div>
        </div>
	#end
    <br>
   </div>
    <div style="width:32%;float:right">
		#@div(divClass="infoContent")
      	  <p class="titleName">历史记录</p>
			#include("/testManagement/page/historyRecord.page")
		#end
	</div>
#end

<script type="text/javascript">
    $(function(){
        $(".selectList").each(function(){
            var url = "#link('/getDist.html')";
            var areaJson;
            var temp_html;
            var oProvince = $(this).find(".province");
            var oCity = $(this).find(".city");
            var oDistrict = $(this).find(".district");
            //初始化省
            var province = function(){
                $.each(areaJson,function(i,province){
                    temp_html+="<option value='"+province.p+"'>"+province.p+"</option>";
                });
                oProvince.html(temp_html);
                city();
            };
            //赋值市
            var city = function(){
                temp_html = "";
                var n = oProvince.get(0).selectedIndex;
                $.each(areaJson[n].c,function(i,city){
                    temp_html+="<option value='"+city.ct+"'>"+city.ct+"</option>";
                });
                oCity.html(temp_html);
                district();
            };
            //赋值县
            var district = function(){
                temp_html = "";
                var m = oProvince.get(0).selectedIndex;
                var n = oCity.get(0).selectedIndex;
                if(typeof(areaJson[m].c[n].d) == "undefined"){
                    oDistrict.css("display","none");
                }else{
                    oDistrict.css("display","inline");
                    $.each(areaJson[m].c[n].d,function(i,district){
                        temp_html+="<option value='"+district.dt+"'>"+district.dt+"</option>";
                    });
                    oDistrict.html(temp_html);
                };
            };
            //选择省改变市
            oProvince.change(function(){
                city();
            });
            //选择市改变县
            oCity.change(function(){
                district();
            });
            //获取json数据
            $.getJSON(url,function(data){
                areaJson = data;
                province();
            });
        });
    });
    $(function(){

        $("form[name=thisform").attr("action",'#link("/Validform_post.html")');
        $("form[name=thisform").Validform({
            tiptype:2,
            usePlugin:{
                //datepicker:{},//日期控件校验;
                passwordstrength:{
                    minLen:6,//设置密码长度最小值，默认为0;
                    maxLen:18,//设置密码长度最大值，默认为30;
                    trigger:function(obj,error){
                        //该表单元素的keyup和blur事件会触发该函数的执行;
                        //obj:当前表单元素jquery对象;
                        //error:所设密码是否符合验证要求，验证不能通过error为true，验证通过则为false;
                        //console.log(error);
                        if(error){
                            obj.parent().find(".Validform_checktip").show();
                            obj.parent().find(".passwordStrength").hide();
                        }else{
                            obj.parent().find(".passwordStrength").show();
                        }
                    }
                }
            },
            ajaxPost:true,
            beforeCheck:function(curform){
                //在表单提交执行验证之前执行的函数，curform参数是当前表单对象。
                //这里明确return false的话将不会继续执行验证操作;
            },
            beforeSubmit:function(curform){
                //在验证成功后，表单提交前执行的函数，curform参数是当前表单对象。
                //这里明确return false的话表单将不会提交;
            },
            callback:function(data){
                if(data.status=="y"){
                    setTimeout(function(){
                        $.Hidemsg(); //公用方法关闭信息提示框;显示方法是$.Showmsg("message goes here.");
                    },2000);
                }
                //返回数据data是json对象，{"info":"demo info","status":"y"}
                //info: 输出提示信息;
                //status: 返回提交数据的状态,是否提交成功。如可以用"y"表示提交成功，"n"表示提交失败，在Validform_post.html文件返回数据里自定字符，主要用在callback函数里根据该值执行相应的回调操作;
                //你也可以在Validform_post.html文件返回更多信息在这里获取，进行相应操作；
                //ajax遇到服务端错误时也会执行回调，这时的data是{ status:**, statusText:**, readyState:**, responseText:** }；

                //这里执行回调操作;
                //注意：如果不是ajax方式提交表单，传入callback，这时data参数是当前表单对象，回调函数会在表单验证全部通过后执行，然后判断是否提交表单，如果callback里明确return false，则表单不会提交，如果return true或没有return，则会提交表单。
            }
        });
    });
</script>
