#import("/org/tinygroup/button/components/button_common.component")
#import("/org/tinygroup/button/components/button.component")
#import("/org/tinygroup/table/components/table.component")
#!set(activeTitle="测试管理",activeMenuId=currentPageId)
<style>
    .select_boxes {
        margin-top: 0
    }
</style>
#@layout(operate)#end
#set(name="qualityBug")
		#@tinyForm("thisform" TINY_CONTEXT_PATH+adminPath+"/quality/bug/copy" "post" {"class":"","enctype":
			"multipart/form-data"})
        <div style="width:100%">
        <div class="infoContent">
            <p class="titleName">复制Bug</p>
			#@elementItem()
				#@colLabel()产品/模块：#end
				#@formControlDiv("col-8")
					#@div(divClass="col-5")
						#@Tselect2F()
							#@Tselect2Body("productId" bug?.productId?:0 {"class":
								"input-text select2"}) ##,"multiple":"multiple"加上为多选项
								#foreach(product : productUtils.getAllProductListByUser())
									#if(product?.deleted==0)
                                        <option value="${product?.productId}">${product?.productName}</option>
									#end
								#end
								#end
                            <script type="text/javascript">
                                $("#${sid}").on("change", function () {
                                    var pId = $("#${sid}  option:selected").val();
                                    if (pId > 0) {
                                        ajaxRead("${sid}", "moduleId", "moduleId", "moduleName", "/quality/bug/ajax/module?moduleRoot=" + pId, ${bug?.moduleId?:0},"module");
										ajaxRead("${sid}", "bugOpenedBuild", "buildId", "buildName", "/quality/bug/ajax/build?buildProduct=" + pId, ${bug?.buildId?:0}, "build");
									}
                                })
                            </script>
							#@Tselect2Fix()
								#set(m=menuManager.getMenu("newproduct"))
								#if(m)
                                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}" class="r">增加</a>
								#end
								#set(m=menuManager.getMenu("allproduct"))
								#if(m)
                                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}">全部</a>
								#end
							#end
						#end

					#end
					#@div(divClass="col-0")&nbsp;&nbsp#end
					#@div(divClass="col-3")
						#@Tselect2F()
							#@Tselect2Body("moduleId" bug?.moduleId?:0 {"class":
								"input-text select2"}) ##,"multiple":"multiple"加上为多选项
                                <option value="0">/</option>
							#end
                            <script type="text/javascript">
                                $("#${sid}").on("change", function () {
                                    var mId = $("#${sid}  option:selected").val();
                                    var pId = $("select[name=productId]  option:selected").val();
                                    if (mId >= 0) {
                                        ajaxRead("${sid}", "storyId", "storyId", "storyTitle", "/quality/bug/ajax/story?productId=" + pId + "&moduleId=" + mId, ${bug?.storyId?: 0});
                                	}
                                })
                            </script>
						#end

					#end

				#end
			#end
			#@elementItem()
				#@colLabel()所属项目：#end
				#@formControlDiv("col-8")
					#@div(divClass="col-5")
						#@Tselect2F()
							#@Tselect2Body("projectId" bug?.projectId?:0 {"class":
								"input-text select2"}) ##,"multiple":"multiple"加上为多选项
                                var em = "
                                <option value='0' selected>/</option>
                                ";
								#foreach(project : projectList)
                                    <option value="${project?.projectId}">${project?.projectName}</option>
								#end
								#end
                            <script type="text/javascript">
                                $("#${sid}").on("change", function () {
                                    var pId = $("#${sid}  option:selected").val();
                                    ajaxRead("${sid}", "taskId", "taskId", "taskName", "/quality/bug/ajax/task?taskProject=" + pId, ${bug?.taskId?: 0}, "task");
                                })
                            </script>
							#@Tselect2Fix()
								#set(m=menuManager.getMenu("project-op-add"))
								#if(m)
                                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}" class="r">增加</a>
								#end
								#set(m=menuManager.getMenu("project-op-all"))
								#if(m)
                                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}">全部</a>
								#end
							#end
						#end
					#end
				#end
				#@validateDiv("col-2")#end
			#end
			#@elementItem()
				#@colLabel()<span class="c-red">*</span>影响版本：#end
				#@formControlDiv("col-8")
					#@div(divClass="col-5")
						#@Tselect2F()
							#@Tselect2Body(
								"bugOpenedBuild" bug?.bugOpenedBuild {"class":"input-text select2","multiple":
								"multiple"}) ##,"multiple":"multiple"加上为多选项

							#end
							#@Tselect2Fix()
								#set(m=menuManager.getMenu("pro-version-add"))
								#if(m)
                                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}" class="r">增加</a>
								#end
								#set(m=menuManager.getMenu("version"))
								#if(m)
                                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}">全部</a>
								#end
							#end
						#end
					#end
				#end
				#@validateDiv("col-2")#end
			#end

			#@elementItem()
				#@colLabel()当前指派：#end
				#@formControlDiv("col-8")
					#@div(divClass="col-5")
						#@Tselect2F()
							#@Tselect2Body("bugAssignedTo" bug?.bugAssignedTo {"class":
								"input-text select2"}) ##,"multiple":"multiple"加上为多选项
                                <option value="0">/</option>
								#foreach(user : userList)
                                    <option value="${user?.orgUserId}">${user?.orgUserRealName}</option>
								#end
							#end
							#@Tselect2Fix()
								#set(m=menuManager.getMenu("organizationAddUser"))
								#if(m)
                                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}" class="r">增加</a>
								#end
								#set(m=menuManager.getMenu("organizationUser"))
								#if(m)
                                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}">全部</a>
								#end
							#end
						#end
					#end
					#@validateDiv("col-2")#end
				#end
				#@validateDiv("col-2")#end
			#end
			#@elementItem()
				#@colLabel()<span class="c-red">*</span>Bug标题/<span class="c-red">*</span>优先级：#end
				#@formControlDiv("col-8")
					#@div(divClass="col-5")
						#tinyInput("text" "bugTitle" bug?.bugTitle {"datatype":"*","id":"版本","class":"input-text"})
					#end
					#@div(divClass="col-0")&nbsp&nbsp#end
					#@div(divClass="col-3")
						#@tinySelect("priority" bug?.priority {"class":"select2"})
							#foreach(pri : getDict("bugPriority"))
								#@tinyOptionItem(pri.value)${pri.text}#end
					#end

					#end
					#end
				#end
				#@validateDiv("col-2")#end
			#end
			#@elementItem()
				#@colLabel()重现步骤：#end
				#@formControlDiv("col-8")
					#@Teditor("bugSteps" "bugSteps" {"initialFrameHeight":"150"})${bug?.bugSteps}#end
				#end
				#@validateDiv("col-2")#end
			#end
			#@elementItem()
				#@colLabel()相关需求：#end
				#@formControlDiv("col-8")
					#@div(divClass="col-5")
						#@Tselect2F()
							#@Tselect2Body(
								"storyId" bug?.storyId {"class":"input-text select2"}) ##,"multiple":"multiple"加上为多选项

							#end
							#@Tselect2Fix()
								#set(m=menuManager.getMenu("product-demand-add"))
								#if(m)
                                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}" class="r">增加</a>
								#end
								#set(m=menuManager.getMenu("product-demand"))
								#if(m)
                                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}">全部</a>
								#end
							#end
						#end
					#end
				#end
			#end
			#@elementItem()
				#@colLabel()相关任务：#end
				#@formControlDiv("col-8")
				#@div(divClass="col-5")
					#@Tselect2F()
						#@Tselect2Body(
							"taskId" bug?.taskId {"class":"input-text select2"}) ##,"multiple":"multiple"加上为多选项

						#end
						#@Tselect2Fix()
							#set(m=menuManager.getMenu("pro-task-proposeversion"))
							#if(m)
                                <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}" class="r">增加</a>
							#end
							#set(m=menuManager.getMenu("task"))
							#if(m)
                                <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}">全部</a>
							#end
						#end
					#end
                #end
				#end
				#@validateDiv("col-2")#end
			#end
			#@elementItem()
				#@colLabel()类型/<span class="c-red">*</span>严重程度：#end
				#@formControlDiv("col-8")
					#@div(divClass="col-5")
					#@tinySelect("bugType" "1" {"class":"select2"})
						#foreach(type : getDict("bugType"))
						#@tinyOptionItem(type.value)${type.text}#end
					#end
					#end
					#end
					#@div(divClass="col-0")&nbsp&nbsp#end
					#@div(divClass="col-3")
						#@Tselect2F()
							#@Tselect2Body("bugSeverity" bug?.bugSeverity {"class":
								"input-text select2"}) ##,"multiple":"multiple"加上为多选项
								#foreach(se : getDict("bugSeverity"))
									#@tinyOptionItem(se.value)${se.text}#end
								#end
							#end
						###@Tselect2Fix()<a href="http://www.baidu.com" class="r ">增加</a><a href="#">全部</a>#end
						#end
					#end
				#end
			#end
			#@elementItem()
				#@colLabel()系统/浏览器：#end
				#@formControlDiv("col-8")
					#@div(divClass="col-5")
						#@tinySelect("operatingSystem" "1" {"class":"select2"})
							#foreach(os : getDict("bugOS"))
								#@tinyOptionItem(os.value)${os.text}#end
					#end
						#end
					#end
					#@div(divClass="col-0")&nbsp&nbsp#end
					#@div(divClass="col-3")
						#@tinySelect("browser" "zh" {"class":"select2"})
							#foreach(bro : getDict("bugBrowser"))
								#@tinyOptionItem(bro.value)${bro.text}#end
							#end

						#end
					#end
				#end
			#end
			#@elementItem()
				#@colLabel()抄送给：#end
				#@formControlDiv("col-8")
					#@div(divClass="col-5")
						#@Tselect2F()
							#@Tselect2Body("bugMailto" bug?.bugMailto {"class":"input-text select2","multiple":
								"multiple"}) ##,"multiple":"multiple"加上为多选项
								#foreach(user : userList)
                                    <option value="${user?.orgUserId}">${user?.orgUserRealName}</option>
								#end
							#end
							#@Tselect2Fix()
								#set(m=menuManager.getMenu("organizationAddUser"))
								#if(m)
                                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}" class="r">增加</a>
								#end
								#set(m=menuManager.getMenu("organizationUser"))
								#if(m)
                                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}">全部</a>
								#end
							#end
						#end
					#end
				#end
				#@validateDiv("col-2")#end
			#end

			#@elementItem()
				#@colLabel()关键词：#end
				#@formControlDiv("col-8")
					#@div(divClass="col-5")
						#tinyInput("text" "bugKeywords" "" {"datatype":"","id":"关键词","class":"input-text"})
				#end
				#end
				#@validateDiv("col-2")#end
			#end
			#@elementItem()
                <div class="col-12">
                    <div class="col-2 text-r"><label>附件：</label></div>
                    <div class="col-9">
						#mulUploadFile(fileList)
                    </div>
                </div>
			#end
			#@elementItem()
                <div class="col-12">
                    <div class="col-5">
                        <button style="float: right" type="submit" id="submit2" class="commitBtn">保存</button>
                    </div>
                    <div class="col-1"></div>
                    <div class="col-1">
					#*                <a href="${TINY_CONTEXT_PATH+adminPath}/testManagement/page/Bug.page">
                                    <button style="float: left" type="button" id="back" class="backBtn">返回</button></a>*#
						#@aExtendButton("btn-sm backBtn" "javascript:history.go(-1)")返回#end
                    </div>
                    <div class="col-5"></div>
                </div>
			#end
            <br>
		#end
    </div>
    </div>


<script>
    $('select.select2').select2()
</script>
<script type="text/javascript">
    $(function () {
        $("form[name=thisform]").Validform({
            tiptype: 2
        });
    });

</script>