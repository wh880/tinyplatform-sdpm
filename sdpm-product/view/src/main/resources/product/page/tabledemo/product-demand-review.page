#import("/org/tinygroup/form/components/form.component")
#import("/org/tinygroup/bootstrapDate/components/bootstrapDate.component")
#import("/org/tinygroup/button/components/button_common.component")
#import("/org/tinygroup/button/components/button.component")
#import("/org/tinygroup/fold/components/fold.component")

#!set(linkName="product-demand",sonitem="
<li>"+"需求"+"</li>")


<script type="text/javascript">
    $(function () {
        $("form[name=thisform").Validform({
            tiptype: 2
        });
    });
</script>

<script>
    $(document).ready(function () {

        ajaxRead("assignTo", "storyId", "storyAssignedTo");
        ajaxRead("reviewBy", "storyId", "storyTitle");

        $("#story_reviewed").on("click", function () {

            var vm = this.checked;
            if (vm == true) {
                $("select[name='storyReviewedBy']").attr("disabled", "disabled");
            }
            if (vm == false) {
                $("select[name='storyReviewedBy']").removeAttr("disabled");
            }


        });

    });
</script>

#@tinyForm("thisform" TINY_CONTEXT_PATH +adminPath+"/product/story/reviewed" "" {"class":"test"})

    #hiddenInput("","storyId","",story.storyId)

<div style="width:70%;float:left" class="pageleftpart">
    <div class="infoContent">
        <p class="titleName">评审</p>


        #@elementItem()
            #@daterangepickerPosition()
                #@colLabel()评审时间：#end
                #@formControlDiv("col-4")
                    #@tinyDateInput("storyReviewedDate" story?.storyReviewedDate?formatDate(story?.storyReviewedDate,
                        'yyyy-MM-dd'):"" "YYYY-MM-DD" {"datatype":"*","nullmsg":"日期不能为空"})#end
                #end
                #@validateDiv("col-2")#end
            #end
        #end


        #@elementItem()
            #@colLabel()评审结果：#end
            #@formControlDiv("col-4")
                #@tinySelect(
                    "reviewRequest" "" {"placeholder":"","datatype":"*","nullmsg":"评审结果不能为空！","class":
                    "input-text","rel":"22"})

                    #foreach(source:getDict("proReviewResult"))
                        <option value="${source?.value}"> ${source?.text}</option>
                    #end

                #end
            #end
            #@validateDiv("col-2")#end
        #end

        #@elementItem()
            #@sdpmItem("指派给")
                <div class="input-group">
                    #@Tselect2F()
                        #@Tselect2Body(
                            "storyAssignedTo" story?.storyAssignedTo {"placeholder":"",
                            "class":"input-text select2","style":"width:300px" })

                        #end
                        <script>
                            ajaxRead("${sid}", "storyAssignedTo", "orgUserId", "orgUserRealName", "/org/user/userList", "");
                        </script>
                        #@Tselect2Fix()
                            <a href="${TINY_CONTEXT_PATH}/a/org/user/form">增加</a>
                            <a href="${TINY_CONTEXT_PATH}/a/org/user/list" class="r">全部</a>
                        #end
                    #end
                </div>
            #end
        #end

        #@elementItem()
            #@colLabel()由谁评审：#end
            #@formControlDiv("col-4")
                #@Tselect2F()
                    #@Tselect2Body("storyReviewedBy" story?.storyReviewedBy {"class":
                        "input-text select2","multiple":"multiple"}) ##,"multiple":"multiple"加上为多选项
                    #end

                    <script>
                        ajaxRead("${sid}", "storyReviewedBy", "orgUserId", "orgUserRealName", "/org/user/userList");
                    </script>

                    #@Tselect2Fix()
                        <a href="${TINY_CONTEXT_PATH}/a/org/user/form">增加</a>
                        <a href="${TINY_CONTEXT_PATH}/a/org/user/list" class="r">全部</a>
                    #end
                #end

            #end
            #@validateDiv("col-2")#end
        #end

        #@elementItem()
            <div class="col-12">
                <div class="col-2 text-r"><label>备注：</label></div>

                <div class="col-9">
                    #@Teditor("actionComment" "actionComment" {"initialFrameHeight":"150"})#end</div>
            </div>
        #end


        #@elementItem()
            <div class="col-12">
                <div class="col-2 text-r"><label>检查影响：</label></div>

                <div class="col-9">
                    #@formControlDiv("col-12")
	    				#include("/product/page/tabledemo/check-effect.page")
 	    			#end
                </div>
            </div>
        #end
    </div>



    #@elementItem()
        <div class="col-12">
            <div class="col-5">

            </div>
            <div class="col-1">
                <button style="float: left" type="submit" id="submit" class="commitBtn">保存</button>
            </div>
            <div class="col-1">
                #@aExtendButton("btn-sm backBtn" "javascript:history.go(-1)")返回#end
            </div>
            <div class="col-5"></div>
        </div>
    #end
    <br>
</div>
#end


<div style="width:30%;float:right">
    #history(adminPath+"/system/action/ajax/history?actionObjectType=story&actionObjectId="+story?.storyId)
</div>