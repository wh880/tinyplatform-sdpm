#!set(linkName="product-demand",sonitem="
<li>"+"需求"+"</li>")


<script>
    $(document).ready(function () {
        $("select[name='storySource']").bind('change', function () {
            if (0 == $(this).val()) {
                $(".customer-request").show();
                $("#demand-sources").addClass("col-5");
            } else {
                $(".customer-request").hide();
                $("#demand-sources").removeClass("col-5");
            }
        });

        $("#story_reviewed").on("click", function () {

            var vm = this.checked;
            if (vm == true) {
                $("select[name='storyReviewedBy']").attr("disabled", "disabled");
            }
            if (vm == false) {
                $("select[name='storyReviewedBy']").removeAttr("disabled");
            }


        });

    });
</script>





#@tinyForm(
    "thisform" TINY_CONTEXT_PATH +adminPath+"/product/story/save" "" {"class":"test","enctype":"multipart/form-data"})

    #hiddenInput("","type","","copy")
<div style="width:100%;" class="pageleftpart">
<div class="infoContent">
    <p class="titleName">提需求</p>
    #@elementItem()
        #@colLabel()所属产品：#end

        #@formControlDiv("col-4")
            <div class="col-6">
                #@Tselect2F()
                    #@Tselect2Body(
                        "productId" cookieProductId {"class":"input-text select2"})
                        <option value="0">/</option>
                    #end
                    <script>
                        ajaxRead("${sid}", "productId", "productId", "productName", "/product/productList", ${story?.productId?:0});
                    </script>
                    <script>
                        $("#${sid}").on("change", function () {
                            var pId = $("#${sid}  option:selected").val();
                            if (pId > 0) {
                                ajaxRead("${sid}", "moduleId", "moduleId", "moduleName", "/quality/bug/ajax/module?moduleRoot=" + pId, "${story?.moduleId?:0}");
                                ajaxRead("${sid}", "planId", "planId", "planName", "/product/plan/planList?productId=" + pId, "${story?.planId?:0}");
                            }
                        })
                    </script>

                    #@Tselect2Fix()
                        #@hasMenu("newproduct")
                            <a href="${TINY_CONTEXT_PATH +adminPath}/product/addproduct/addition "
                               class="r ">增加</a>
                        #end
                        #@hasMenu("allproduct")
                            <a href=" ${TINY_CONTEXT_PATH +adminPath}/product/allproduct/addition">全部</a>
                        #end
                    #end
                #end
            </div>
            <div class="col-6">
                #@Tselect2F()
                    #@Tselect2Body(
                        "moduleId" "" {"class":"input-text select2","data":"moduleType=product","relateElem":
                        "relateModelTwo"}) ##,"multiple":"multiple"加上为多选项

                    #end

                    #@Tselect2Fix()<a href="${TINY_CONTEXT_PATH +adminPath}/product/page/tabledemo/addProduct.page"
                                      class="r ">增加</a><a
                            href=" ${TINY_CONTEXT_PATH +adminPath}/product/page/tabledemo/product-listall.page">全部</a>#end
                #end
            </div>
        #end



    #end

    #@elementItem()
        #@colLabel()所属计划：#end
        #@formControlDiv("col-4")
            #@Tselect2F()
                #@Tselect2Body("planId" "" {"class":"input-text select2"}) ##,"multiple":"multiple"加上为多选项

                #end

                #@Tselect2Fix()
                    #@hasMenu("product-plan-add")
                        <a href="${TINY_CONTEXT_PATH +adminPath}/product/plan/addplan"
                           class="r ">增加</a>
                    #end
                #end
            #end
        #end
        #@validateDiv("col-2")#end
    #end

    #@elementItem()
        #@colLabel()<span class="c-red">*</span>来源：#end
        #@formControlDiv("col-4")
            <div id="demand-sources">
                #@Tselect2F()
                    #@Tselect2Body("storySource" "0" {"class":
                        "input-text select2"}) ##,"multiple":"multiple"加上为多选项#foreach(stage:getDict("storySource"))

                        #foreach(source:getDict("storySource"))
                            <option value="${source?.value}"> ${source?.text}</option>
                        #end

                    #end

                #end
            </div>
        <span class="customer-request" style="display:none">
            <div class="col-2 text-c">&nbsp;<span class="c-red">*</span>请求：
            </div>

        <div class="col-5">

            #@Tselect2F()
                #@Tselect2Body("clientRequestId" story?.clientRequestId {"class":
                    "input-text select2"}) ##,"multiple":"multiple"加上为多选项
                    #foreach(re : requestList)
                    <option value="${re?.clientRequestId}">${re?.clientName+"/"+re?.requestTitle}</option>
                #end
            #end
            #@Tselect2Fix()
                #@hasMenu("request-add")
                    <a href="${TINY_CONTEXT_PATH +adminPath}/service/request/form"
                       class="r ">增加</a>
                #end
            #end
        #end
    </div>
    </span>

    #end
#end


#@elementItem()
    #@colLabel()需求名称：#end
    #@formControlDiv("col-4")
        #tinyInput(
            "text" "storyTitle" story?.storyTitle {"placeholder":"请输入需求名称","datatype":"*","nullmsg":"需求名称不能为空！","id":
            "email",
            "class":"input-text"})
    #end
    #@validateDiv("col-2")#end
#end


#@elementItem()
    #@colLabel()需求描述：#end
    #@formControlDiv("col-8")
        #@tinyTextarea("storySpec" {"datatype":""})${storySpec?.storySpec}#end
    #end
    #@validateDiv("col-2")#end
#end

#@elementItem()
    #@colLabel()验收标准：#end
    #@formControlDiv("col-8")
        #@tinyTextarea("storyVerification" {"datatype":""})${storySpec?.storyVerification}#end
    #end
    #@validateDiv("col-2")#end
#end

#@elementItem()
    #@colLabel()优先级：#end
    #@formControlDiv("col-4")
        #@Tselect2F()
            #@Tselect2Body("storyPri" story?.storyPri {"class":"input-text select2"}) ##,"multiple":"multiple"加上为多选项
                #foreach(pri:getDict("storyPri"))
                    <option value="${pri?.value}"> ${pri?.text}</option>
                #end
            #end

        #end
    #end
    #@validateDiv("col-2")#end
#end

#@elementItem()
    #@colLabel()预计工时：#end
    #@formControlDiv("col-4")
        <div class="input-group">
            <input type="text" class="form-control" name="storyEstimate" placeholder=""
                   value="${story?.storyEstimate}" aria-describedby="basic-addon2">
            <span class="input-group-addon" id="basic-addon2">小时</span>
        </div>
    #end
    #@validateDiv("col-2")#end
#end

#@elementItem()
    #@sdpmItem("由谁评审")
        #@Tselect2F()
            #@Tselect2Body(
                "storyReviewedBy" "" {"class":"input-text select2"})

            #end
            <script>
                ajaxRead("${sid}", "storyReviewedBy", "orgUserId", "orgUserRealName", "/org/user/userList", "${story?.storyReviewedBy?:0}");
            </script>

            #@Tselect2Fix()
                #set(m=menuManager.getMenu("organizationAddUser"))
                #if(m)
                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}" class="r">增加</a>
                #end
                #set(m=menuManager.getMenu("organizationUser"))
                #if(m)
                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}">全部</a>
                #end
            #end
        #end


    #end
    #@checkboxBox()

        #@label(labelFor="checkbox-6")
            #input(inputId="story_reviewed" inputName="storyReviewedBy1" inputType="checkbox" )
            不需要评审
        #end
    #end

#end
#@elementItem()
    #@colLabel()抄送给：#end
    #@formControlDiv("col-4")
        #@Tselect2F()
            #@Tselect2Body("storyMailto" "" {"class":"input-text select2","multiple":
                "multiple"})
            #end
            <script>
                ajaxRead("${sid}", "storyMailto", "orgUserId", "orgUserRealName", "/org/user/userList");
            </script>
            #@Tselect2Fix()
                #set(m=menuManager.getMenu("organizationAddUser"))
                #if(m)
                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}" class="r">增加</a>
                #end
                #set(m=menuManager.getMenu("organizationUser"))
                #if(m)
                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}">全部</a>
                #end
            #end
        #end
    #end
    #@validateDiv("col-2")#end
#end
#@elementItem()
    #@colLabel()关键词：#end
    #@formControlDiv("col-4")
        #tinyInput(
            "text" "storyKeywords" story?.storyKeywords {"datatype":"","id":"text","class":"input-text"})
    #end
    #@validateDiv("col-2")#end
#end
#@elementItem()
    #@colLabel()附件：#end
    #@formControlDiv("col-10")
        #mulUploadFile()
    #end
    #@validateDiv("col-2")#end
#end
</div>
#@elementItem()
<div class="col-12">
    <div class="col-5">

    </div>
    <div class="col-1">
        <button style="float: left" type="submit" id="submit2" class="commitBtn">保存</button>
    </div>
    <div class="col-1">
        #@aExtendButton("btn-sm backBtn" "javascript:history.go(-1)")返回#end
    </div>
    <div class="col-5"></div>

#end
</div>
#end
    <script type="text/javascript">
        $(function () {
            $("form[name=thisform").Validform({
                tiptype: 2
            });
        });
    </script>

