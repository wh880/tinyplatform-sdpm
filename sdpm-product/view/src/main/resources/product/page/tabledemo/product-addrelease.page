#import("/org/tinygroup/form/components/form.component")
#import("/org/tinygroup/button/components/button_common.component")
#import("/org/tinygroup/button/components/button.component")
#!set(linkName="product-release",sonitem="
<li>"+"发布"+"</li>")

<script>
    $(document).ready(function () {

        ajaxRead("addrel", "moduleId", "moduleName");

    });
</script>

#@tinyForm(
    "thisform" TINY_CONTEXT_PATH +adminPath+"/product/release/save" "post" {"class":"","enctype":"multipart/form-data"})
##    #hiddenInput("productId","productId","",cookieProductId)
<div class="infoContent">
    <p class="titleName">创建新发布</p>

#*    <div class="RTtitle">
        <button type="submit" id="submit" class="commitBtn">保存</button>
    </div>*#

    #@elementItem()
        #@colLabel()<span class="c-red">*</span>发布名称:#end
        #@formControlDiv("col-4")
            #tinyInput(
                "text" "releaseName" ""{"datatype":"*","nullmsg":"发布名称不能为空！","id":"username","class":"input-text"})
            <script>
                $("input[name=releaseName]").on("blur", function () {
                    var pName = $(this).val();
                    if (pName) {
                        var pId = "${cookieProductId}";
                        if (pId > 0) {
                            $.ajax({
                                url: "${TINY_CONTEXT_PATH+adminPath}/product/release/judgeReleaseName",
                                type: "POST",
                                data: {releaseName: pName, productId: pId},
                                success: function (data) {
                                    if (data.status == "y") {
                                        $("input[name=releaseName]").addClass("Validform_error");
                                        $("input[name=releaseName]").parent().parent().find("div[class=col-2]").html("<span class='Validform_checktip Validform_wrong'>该发布已存在！</span>");
                                    } else {
                                        $("input[name=releaseName]").removeClass("Validform_error");
                                        $("input[name=releaseName]").parent().parent().find("div[class=col-2]").html("");
                                    }
                                }
                            });
                            return false;
                        }
                    }
                });
            </script>
        #end
        #@validateDiv("col-2")#end
    #end
    #@elementItem()
        #@colLabel()版本:#end
        #@formControlDiv("col-4")
            #@Tselect2F()
                #@Tselect2Body(
                    "buildId" "" {"class":"input-text select2","url":"/system/module/moduleList","ajaxType":"addrel",
                    "data":""}) ##,"multiple":"multiple"加上为多选项
                #end
                <script>
                    ajaxRead("${sid}", "buildId", "buildId", "buildName", "/project/build/buildList?buildProduct=${cookieProductId}&from=product");
                </script>
                #@Tselect2Fix()
                    #@hasMenu("pro-version-add")
                        <a href="${TINY_CONTEXT_PATH +adminPath}/project/build/edit"
                           class="r ">增加</a>
                    #end
                    #@hasMenu("version")
                        <a href="${TINY_CONTEXT_PATH +adminPath}/project/build/index">全部</a>
                    #end
                #end
            #end
        #end
        #@validateDiv("col-2")#end
    #end

    #@elementItem()
        #@colLabel()<span class="c-red">*</span>发布日期:#end
        #@formControlDiv("col-4")
            #@tinyDateInput("releaseDate" "" "YYYY-MM-DD" {"datatype":"*","nullmsg":"日期不能为空"})#end
        #end
        #@validateDiv("col-2")#end
    #end

    #@elementItem()
        #@colLabel()描述:#end
        #@formControlDiv("col-8")
            #@Teditor(
                "releaseDesc" "releaseDesc" {"initialFrameHeight":"250" ,"placeholder":"说点什么...最少输入10个字符","datatype":
                ""})#end
        #end
        #@validateDiv("col-2")#end
    #end

    #@elementItem()
        <div class="col-12">
            <div class="col-2 text-r"><label>附件：</label></div>

            <div class="col-9">
                #@formControlDiv("col-12")
		   				#include("/product/page/event/fileupload.page")
      				 		#end
            </div>
        </div>
    #end
</div>
    #@elementItem()
    <div class="col-12">
        <div class="col-5">

        </div>
        <div class="col-1">
            <button style="float: left" type="submit" id="submit" class="commitBtn">保存</button>
        </div>
        <div class="col-1">
            #@aExtendButton("btn-sm backBtn" "javascript:history.go(-1)")返回#end
        </div>
        <div class="col-5"></div>
    </div>
    #end
#end


<script type="text/javascript">
    $(function () {
        $("form[name=thisform").Validform({
            tiptype: 2
        });
    });
</script>