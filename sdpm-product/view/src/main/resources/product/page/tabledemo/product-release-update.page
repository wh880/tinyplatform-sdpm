#import("/org/tinygroup/form/components/form.component")
#import("/org/tinygroup/button/components/button_common.component")
#import("/org/tinygroup/button/components/button.component")
#!set(linkName="product-release",sonitem="<li>"+"发布"+"</li>")
<script type="text/javascript">
    $(function () {
        $("form[name=thisform").Validform({
            tiptype: 2
        });
    });
</script>

#@tinyForm("thisform" TINY_CONTEXT_PATH +adminPath+"/product/release/update" "post" {"class":"","enctype":
    "multipart/form-data"})

	#tinyInput("text" "releaseId" release.releaseId {"class":"input-text hidden"})
    <div class="infoContent">
        <p class="titleName">编辑</p>

     #@elementItem()
        #@colLabel()发布名称:#end
        #@formControlDiv("col-4")
        	#tinyInput("text" "releaseName" release?.releaseName {"datatype":"*","nullmsg":"发布名称不能为空！","class":"input-text"})
       #end
         <script>
             $("input[name=releaseName]").on("blur",function(){
                 var pName = $(this).val();
                 if(pName){
                     var pId = "${cookieProductId}";
                     if(pId>0){
                         $.ajax({
                             url:"${TINY_CONTEXT_PATH+adminPath}/product/release/judgeReleaseName",
                             type:"POST",
                             data:{releaseName:pName,productId:pId,releaseId:"${release?.releaseId}"},
                             success:function(data){
                                 if(data.status=="y"){
                                     $("input[name=releaseName]").addClass("Validform_error");
                                     $("input[name=releaseName]").parent().parent().find("div[class=col-2]").html("<span class='Validform_checktip Validform_wrong'>该发布已存在！</span>");
                                 }else{
                                     $("input[name=releaseName]").removeClass("Validform_error");
                                     $("input[name=releaseName]").parent().parent().find("div[class=col-2]").html("");
                                 }
                             }
                         });
                         return false;
                     }
                 }
             });
         </script>
        #@validateDiv("col-2")#end
      #end
    #@elementItem()
        #@colLabel()版本:#end
       #@formControlDiv("col-4")
			#@Tselect2F()
                #@Tselect2Body("buildId" release?.buildId {"class":"input-text select2"}) ##,"multiple":"multiple"加上为多选项
                #end
                <script>
                   ajaxRead("${sid}", "buildId", "buildId", "buildName", "/project/build/buildList?buildProduct=${cookieProductId}&from=product");
                </script>
                #@Tselect2Fix()
                    #set(m=menuManager.getMenu("organizationAddUser"))
                    #if(m)
                        <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}" class="r">增加</a>
                    #end
                    #set(m=menuManager.getMenu("organizationUser"))
                    #if(m)
                        <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}">全部</a>
                    #end
                #end

            #end
		#end
        #@validateDiv("col-2")#end
    #end

    #@elementItem()
        #@colLabel()发布日期:#end
        #@formControlDiv("col-4")
           #@tinyDateInput("releaseDate" release?.releaseDate?formatDate(release?.releaseDate,'yyyy-MM-dd'):"" "YYYY-MM-DD" {"datatype":"*","nullmsg":"日期不能为空"})#end
        #end
        #@validateDiv("col-2")#end
    #end
   
    #@elementItem()
        #@colLabel()描述:#end
        #@formControlDiv("col-8")
           #@Teditor("releaseDesc" "releaseDesc" {"initialFrameHeight":"250" ,"placeholder":"说点什么...最少输入10个字符","datatype":"*10-500"})${release?.releaseDesc}#end
        #end
        #@validateDiv("col-2")#end
    #end
    
   #@elementItem()
        <div class="col-12">
                <div class="col-2 text-r"><label>附件：</label></div>
                <div class="col-9">
                  #@formControlDiv("col-12")
		   				#include("/product/page/event/fileupload.page")
      				 		#end
       				</div>
            </div>
   		 #end
   </div>
    #@elementItem()
        <div class="col-12">
            <div class="col-5">

            </div>
            <div class="col-1">
                <button style="float: left" type="submit" id="submit" class="commitBtn">保存</button>
            </div>
            <div class="col-1">
                #@aExtendButton("btn-sm backBtn" "javascript:history.go(-1)")返回#end
            </div>
            <div class="col-5"></div>
        </div>
    #end
#*   </div>*#
#end
#*
<div style="width:30%;float:right">
    #@div(divClass="infoContent")
        <p class="titleName">历史记录</p>
        #include("/product/page/tabledemo/historyrecord.page")
    #end
</div>*#