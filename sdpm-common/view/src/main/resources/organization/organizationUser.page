#!set(activeTitle="组织管理",activeMenuId=currentPageId)
#import("/org/tinygroup/zTree/components/zTree.component")
#import("/components/org/tinygroup/fulimanageui/form.component")
#include("/organizationOther/common.page")
<style>
    .tabLayout .tabBar span a{color:#333}
    .tabLayout .tabBar .Current a{color:#fff}
    .operationbar{border-top:none;background:#f9fafe;padding:6px 5px 6px 10px;}

</style>
<style type="text/css">
    #showsearchmore{cursor:pointer}
    #searchform table{display:inline}
    #searchform td{vertical-align: middle;padding:1px!important;}
    #searchform .form-control{padding:0;line-height:25px;height:25px}

</style>

#@div()
    #@div(divClass="tabLayout")
        #@div(divClass="tabBar cl")
        <span class="Current"><a href="${TINY_CONTEXT_PATH}/organization/organizationUser.page?currentPageId=7">用户</a></span>
        <span><a href="${TINY_CONTEXT_PATH}/organization/organizationGtasks.page?currentPageId=7">待办</a></span>
        <span><a href="${TINY_CONTEXT_PATH}/organization/organizationLog.page?currentPageId=7">日志</a></span>
        <span><a href="${TINY_CONTEXT_PATH}/organization/organizationActive.page?currentPageId=7">动态</a></span>
        <span><a href="${TINY_CONTEXT_PATH}/organization/organizationDepartment.page?currentPageId=7">部门</a></span>
        <span><a href="${TINY_CONTEXT_PATH}/organization/organizationPrivilege.page?currentPageId=7">权限</a></span>
        <span><a href="${TINY_CONTEXT_PATH}/organization/organizationCompany.page?currentPageId=7">公司</a></span>
        #end



    #@div(divClass="operationbar")

##   多重搜索
    <form method="post" action="" id="searchform" class="form-condensed">
        <div class="hide">
            <select id="operatortemp">
                <option value="=">=</option>
                <option value="!=">!=</option>
                <option value="&gt;">&gt;</option>
                <option value="&gt;=">&gt;=</option>
                <option value="&lt;">&lt;</option>
                <option value="&lt;=">&lt;=</option>
                <option value="include">包含</option>
                <option value="between">介于</option>
                <option value="notinclude">不包含</option>
                <option value="belong">从属于</option>
            </select>
            <select id="usertemp">
                <option value="" selected="selected"></option>
                <option value="admin">A:admin</option>
                <option value="demo">D:Demo</option>
                <option value="dev1">D:开发甲</option>
                <option value="dev2">D:开发乙</option>
                <option value="dev3">D:开发丙</option>
                <option value="productManager">P:产品经理</option>
                <option value="projectManager">P:项目经理</option>
                <option value="tester1">T:测试甲</option>
                <option value="tester2">T:测试乙</option>
                <option value="tester3">T:测试丙</option>
                <option value="testManager">T:测试经理</option>
                <option value="closed">Closed</option>
                <option value="$@me">自己</option>
                <option value="null">空</option>
            </select>
            <select id="pritemp">
                <option value="0"></option>
                <option value="3">3</option>
                <option value="1">1</option>
                <option value="44">44</option>
                <option value="2">2</option>
                <option value="4">4</option>
                <option value="null">空</option>
            </select>
            <select id="statustemp">
                <option value="" selected="selected"></option>
                <option value="wait">未开始</option>
                <option value="doing">进行中</option>
                <option value="done">已完成</option>
                <option value="pause">已暂停</option>
                <option value="cancel">已取消</option>
                <option value="closed">已关闭</option>
                <option value="null">空</option>
            </select>

        </div>
        <table class="table table-condensed table-form" id="task-search">
            <tbody><tr>
                <td class="w-400px">
                    <table class="table active-disabled">
                        <tbody><tr id="searchbox1" class=""><td class="text-right w-60px"><span id="searchgroup1"><strong>第一组</strong></span><input type="hidden" name="andOr1" id="andOr1" value="AND">
                        </td><td class="w-90px"><select name="field1" id="field1" class="form-control "></select>
                        </td><td class="w-70px"><select name="operator1" id="operator1" class="form-control "></select>
                        </td>
                            <td id="valueBox1" ></td></tr><tr id="searchbox2" class=""><td class="text-right w-60px" valign="middle"><select name="andOr2" id="andOr2" class="form-control ">
                            <option value="and" selected="selected">并且</option>
                            <option value="or">或者</option>
                        </select>
                        </td><td class="w-90px"><select name="field2" id="field2" class="form-control ">
                        </select>
                        </td><td class="w-70px"><select name="operator2" id="operator2" class="form-control "></select>
                        </td><td id="valueBox2"><input type="text" name="value2" id="value2" value="" class="form-control   ">
                        </td></tr><tr id="searchbox3" class=""><td class="text-right w-60px"><select name="andOr3" id="andOr3" class="form-control ">
                            <option value="and" selected="selected">并且</option>
                            <option value="or">或者</option>
                        </select>
                        </td><td class="w-90px"><select name="field3" id="field3" class="form-control ">
                        </select>
                        </td><td class="w-70px"><select name="operator3" id="operator3" class="form-control "></select>
                        </td><td id="valueBox3"></td></tr>
                        </tbody></table>
                </td>
                <td class="text-center nobr w-90px form-inline"><select name="groupAndOr" id="groupAndOr" class="form-control w-60px">
                    <option value="and" selected="selected">并且</option>
                    <option value="or">或者</option>
                </select>
                </td>
                <td class="w-400px">
                    <table class="table active-disabled">
                        <tbody><tr id="searchbox4" class=""><td class="text-right w-60px"><span id="searchgroup2"><strong>第二组</strong></span><input type="hidden" name="andOr4" id="andOr4" value="AND">
                        </td><td class="w-90px"><select name="field4" id="field4" class="form-control ">
                        </select>
                        </td><td class="w-70px"><select name="operator4" id="operator4" class="form-control "></select>
                        </td><td id="valueBox4"></td></tr><tr id="searchbox5" class=""><td class="text-right w-60px"><select name="andOr5" id="andOr5" class="form-control ">
                            <option value="and" selected="selected">并且</option>
                            <option value="or">或者</option>
                        </select>
                        </td><td class="w-90px"><select name="field5" id="field5" class="form-control ">
                        </select>
                        </td><td class="w-70px"><select name="operator5" id="operator5" class="form-control "></select>
                        </td><td id="valueBox5"></td></tr><tr id="searchbox6" class=""><td class="text-right w-60px"><select name="andOr6" id="andOr6" class="form-control ">
                            <option value="and" selected="selected">并且</option>
                            <option value="or">或者</option>
                        </select>
                        </td><td class="w-90px"><select name="field6" id="field6" class="form-control ">
                        </select>
                        </td><td class="w-70px"><select name="operator6" id="operator6" class="form-control "></select>
                        </td><td id="valueBox6">
                        </td></tr>
                        </tbody></table>
                </td>
                <td class="w-180px"><div class="btn-group"> <button type="submit" id="submit" class="btn btn-submit btn-primary btn-sm">搜索</button> <button type="button" onclick="resetForm(this)" class="btn btn-sm">重置</button></td>
                <td id="moreOrLite">
                    <a id="searchmore" href="javascript:;" ><i class="icon-double-angle-down icon-2x"></i></a>
                    <a id="searchlite" href="javascript:;" ><i class="icon-double-angle-up icon-2x"></i></a>
                </td>
            </tr>
            </tbody></table>
##        <div id="moreOrLite">
##            <a id="searchmore" href="javascript:;" ><i class="icon-double-angle-down icon-2x"></i></a>
##            <a id="searchlite" href="javascript:;" ><i class="icon-double-angle-up icon-2x"></i></a>
##        </div>
    </form>
    #end
    #@toggleBox({"class":"open"})##展开为class:OPEN 要附加其它的属性请用MAP带入
        #@toggleLeft({"class":"aclass"})
            #@settoggleLeftTitle()网站建设一期#end
            #@settoggleLeftBody("treeLeftbox")
                <ul class="treeList">
                    <li id="listContent" style="display:none; position:absolute;left:74px;">
                        <ul id="alternative" class="ztree"
                            style="width:126px;min-height:160px;max-height:300px;"></ul>
                    </li>
                </ul>
            <ul id="treeDrag" class="ztree"></ul>
            #end
        #end
        #@toggleRight()
            #include("/organizationTable/userRightTable.page")
        #end
    #end
#end
#end


<script type="text/javascript">
    <!--
    var setting = {
        view: {
            addHoverDom: addHoverDom,
            removeHoverDom: removeHoverDom,
            selectedMulti: false
        },
        edit: {
            enable: true,
            editNameSelectAll: true,

        },
        data: {
            simpleData: {
                enable: true
            }
        },
        callback: {
            beforeDrag: beforeDrag,
            beforeEditName: beforeEditName,
            beforeRemove: beforeRemove,
            beforeRename: beforeRename,
            onRemove: onRemove,
            onRename: onRename
        }
    };
    var treeNodes = [
        {id: 1, pId: 0, name: "随意拖拽", open: true},
        {id: 11, pId: 1, name: "年龄 1-1"},
        {id: 12, pId: 1, name: "年龄 1-2"},
        {id: 13, pId: 1, name: "年龄 1-3"},
        {id: 2, pId: 0, name: "随意拖拽2", open: true},
        {id: 21, pId: 2, name: "学历 2-1"},
        {id: 22, pId: 2, name: "学历  2-2"},
        {id: 23, pId: 2, name: "学历  2-3"},
        {id: 3, pId: 0, name: "禁止拖拽3", open: true, drag: false},
        {id: 31, pId: 3, name: "城市 3-1", drag: false},
        {id: 32, pId: 3, name: "城市 3-2", drag: false},
        {id: 33, pId: 3, name: "地区 3-3", drag: false}
    ];

    var log, className = "dark";
    function beforeDrag(treeId, treeNodes) {
        return false;
    }
    function beforeEditName(treeId, treeNode) {
        className = (className === "dark" ? "" : "dark");
        showLog("[ " + getTime() + " beforeEditName ]&nbsp;&nbsp;&nbsp;&nbsp; " + treeNode.name);
        var zTree = $.fn.zTree.getZTreeObj("treeDrag");
        zTree.selectNode(treeNode);
        return confirm("进入节点 -- " + treeNode.name + " 的编辑状态吗？");
    }
    function beforeRemove(treeId, treeNode) {
        className = (className === "dark" ? "" : "dark");
        showLog("[ " + getTime() + " beforeRemove ]&nbsp;&nbsp;&nbsp;&nbsp; " + treeNode.name);
        var zTree = $.fn.zTree.getZTreeObj("treeDrag");
        zTree.selectNode(treeNode);
        return confirm("确认删除 节点 -- " + treeNode.name + " 吗？");
    }
    function onRemove(e, treeId, treeNode) {
        showLog("[ " + getTime() + " onRemove ]&nbsp;&nbsp;&nbsp;&nbsp; " + treeNode.name);
    }
    function beforeRename(treeId, treeNode, newName, isCancel) {
        className = (className === "dark" ? "" : "dark");
        showLog((isCancel ? "<span style='color:red'>" : "") + "[ " + getTime() + " beforeRename ]&nbsp;&nbsp;&nbsp;&nbsp; " + treeNode.name + (isCancel ? "</span>" : ""));
        if (newName.length == 0) {
            alert("节点名称不能为空.");
            var zTree = $.fn.zTree.getZTreeObj("treeDrag");
            setTimeout(function () {
                zTree.editName(treeNode)
            }, 10);
            return false;
        }
        return true;
    }
    function onRename(e, treeId, treeNode, isCancel) {
        showLog((isCancel ? "<span style='color:red'>" : "") + "[ " + getTime() + " onRename ]&nbsp;&nbsp;&nbsp;&nbsp; " + treeNode.name + (isCancel ? "</span>" : ""));
    }
    function showRemoveBtn(treeId, treeNode) {
        return !treeNode.isFirstNode;
    }
    function showRenameBtn(treeId, treeNode) {
        return !treeNode.isLastNode;
    }
    function showLog(str) {
        if (!log) log = $("#log");
        log.append("<li class='" + className + "'>" + str + "</li>");
        if (log.children("li").length > 8) {
            log.get(0).removeChild(log.children("li")[0]);
        }
    }
    function getTime() {
        var now = new Date(),
                h = now.getHours(),
                m = now.getMinutes(),
                s = now.getSeconds(),
                ms = now.getMilliseconds();
        return (h + ":" + m + ":" + s + " " + ms);
    }

    var newCount = 1;
    function addHoverDom(treeId, treeNode) {
        var sObj = $("#" + treeNode.tId + "_span");
        if (treeNode.editNameFlag || $("#addBtn_" + treeNode.tId).length > 0) return;
        var addStr = "<span class='button add' id='addBtn_" + treeNode.tId
                + "' title='add node' onfocus='this.blur();'></span>";
        sObj.after(addStr);
        var btn = $("#addBtn_" + treeNode.tId);
        if (btn) btn.bind("click", function () {
            var zTree = $.fn.zTree.getZTreeObj("treeDrag");
            zTree.addNodes(treeNode, {id: (100 + newCount), pId: treeNode.id, name: "new node" + (newCount++)});
            return false;
        });
    }
    ;
    function removeHoverDom(treeId, treeNode) {
        $("#addBtn_" + treeNode.tId).unbind().remove();
    }
    ;
    function selectAll() {
        var zTree = $.fn.zTree.getZTreeObj("treeDrag");
        zTree.setting.edit.editNameSelectAll = $("#selectAll").attr("checked");
    }

    $(document).ready(function () {
        $.fn.zTree.init($("#treeDrag"), setting);
        $("#selectAll").bind("click", selectAll);
    });
    //-->

    function dropPrev(treeId, nodes, targetNode) {
        var pNode = targetNode.getParentNode();
        if (pNode && pNode.dropInner === false) {
            return false;
        } else {
            for (var i = 0, l = curDragNodes.length; i < l; i++) {
                var curPNode = curDragNodes[i].getParentNode();
                if (curPNode && curPNode !== targetNode.getParentNode() && curPNode.childOuter === false) {
                    return false;
                }
            }
        }
        return true;
    }
    function dropInner(treeId, nodes, targetNode) {
        if (targetNode && targetNode.dropInner === false) {
            return false;
        } else {
            for (var i = 0, l = curDragNodes.length; i < l; i++) {
                if (!targetNode && curDragNodes[i].dropRoot === false) {
                    return false;
                } else if (curDragNodes[i].parentTId && curDragNodes[i].getParentNode() !== targetNode && curDragNodes[i].getParentNode().childOuter === false) {
                    return false;
                }
            }
        }
        return true;
    }
    function dropNext(treeId, nodes, targetNode) {
        var pNode = targetNode.getParentNode();
        if (pNode && pNode.dropInner === false) {
            return false;
        } else {
            for (var i = 0, l = curDragNodes.length; i < l; i++) {
                var curPNode = curDragNodes[i].getParentNode();
                if (curPNode && curPNode !== targetNode.getParentNode() && curPNode.childOuter === false) {
                    return false;
                }
            }
        }
        return true;
    }

    var log, className = "dark", curDragNodes, autoExpandNode;
    function beforeDrag(treeId, treeNodes) {
        className = (className === "dark" ? "" : "dark");
        showLog("[ " + getTime() + " beforeDrag ]&nbsp;&nbsp;&nbsp;&nbsp; drag: " + treeNodes.length + " nodes.");
        for (var i = 0, l = treeNodes.length; i < l; i++) {
            if (treeNodes[i].drag === false) {
                curDragNodes = null;
                return false;
            } else if (treeNodes[i].parentTId && treeNodes[i].getParentNode().childDrag === false) {
                curDragNodes = null;
                return false;
            }
        }
        curDragNodes = treeNodes;
        return true;
    }
    function beforeDragOpen(treeId, treeNode) {
        autoExpandNode = treeNode;
        return true;
    }
    function beforeDrop(treeId, treeNodes, targetNode, moveType, isCopy) {
        className = (className === "dark" ? "" : "dark");
        showLog("[ " + getTime() + " beforeDrop ]&nbsp;&nbsp;&nbsp;&nbsp; moveType:" + moveType);
        showLog("target: " + (targetNode ? targetNode.name : "root") + "  -- is " + (isCopy == null ? "cancel" : isCopy ? "copy" : "move"));
        return true;
    }
    function onDrag(event, treeId, treeNodes) {
        className = (className === "dark" ? "" : "dark");
        showLog("[ " + getTime() + " onDrag ]&nbsp;&nbsp;&nbsp;&nbsp; drag: " + treeNodes.length + " nodes.");
    }
    function onDrop(event, treeId, treeNodes, targetNode, moveType, isCopy) {
        className = (className === "dark" ? "" : "dark");
        showLog("[ " + getTime() + " onDrop ]&nbsp;&nbsp;&nbsp;&nbsp; moveType:" + moveType);
        showLog("target: " + (targetNode ? targetNode.name : "root") + "  -- is " + (isCopy == null ? "cancel" : isCopy ? "copy" : "move"))
    }
    function onExpand(event, treeId, treeNode) {
        if (treeNode === autoExpandNode) {
            className = (className === "dark" ? "" : "dark");
            showLog("[ " + getTime() + " onExpand ]&nbsp;&nbsp;&nbsp;&nbsp;" + treeNode.name);
        }
    }

    function showLog(str) {
        if (!log) log = $("#log");
        log.append("<li class='" + className + "'>" + str + "</li>");
        if (log.children("li").length > 8) {
            log.get(0).removeChild(log.children("li")[0]);
        }
    }
    function getTime() {
        var now = new Date(),
                h = now.getHours(),
                m = now.getMinutes(),
                s = now.getSeconds(),
                ms = now.getMilliseconds();
        return (h + ":" + m + ":" + s + " " + ms);
    }

    function setTrigger() {
        var zTree = $.fn.zTree.getZTreeObj("treeDrag");
        zTree.setting.edit.drag.autoExpandTrigger = $("#callbackTrigger").attr("checked");
    }

    $(document).ready(function () {
        $.fn.zTree.init($("#treeDrag"), setting, treeNodes);
        $("#callbackTrigger").bind("change", {}, setTrigger);
    });
    //-->
</script>
<script type="text/javascript">
    <!--
    $(function(){
        $("#showsearchmore").click(function(){
            $("#searchform").toggleClass("showmore");
        });
        $("#searchmore").click(function(){
            $("#searchlite").css("display","block");
            $(this).hide();
            $("#searchbox5,#searchbox6,#searchbox2,#searchbox3").show();
        });
        $("#searchlite").click(function(){
            $("#searchmore").css("display","block");
            $(this).hide();
            $("#searchbox5,#searchbox6,#searchbox2,#searchbox3").hide();
        });
        var itemlist=[]
        itemlist.push({
            "name":"name",
            "title":"真实姓名",
            "operator":"include",
            "value":"text"
        });
        itemlist.push({
            "name":"email",
            "title":"邮箱",
            "operator":"=",
            "value":"text"
        });
        itemlist.push({
            "name":"apartment",
            "title":"所属部门",
            "operator":"=",
            "value":"status"
        });
        itemlist.push({
            "name":"uerNumber",
            "title":"用户名",
            "operator":"include",
            "value":"text"
        });
        itemlist.push({
            "name":"positio",
            "title":"职位",
            "operator":"=",
            "value":"user"
        });
        itemlist.push({
            "name":"phoneNumber",
            "title":"电话",
            "operator":"=",
            "value":"pri"
        });
        itemlist.push({
            "name":"joinDate",
            "title":"加入日期",
            "operator":"=",
            "value":"text"
        });
        itemlist.push({
            "name":"number",
            "title":"编号",
            "operator":"=",
            "value":"text"
        });
        itemlist.push({
            "name":"codeAccount",
            "title":"源代码账号",
            "operator":"=",
            "value":"text"
        });
        itemlist.push({
            "name":"birthday",
            "title":"出生年",
            "operator":"=",
            "value":"text"
        });
        itemlist.push({
            "name":"sex",
            "title":"性别",
            "operator":"=",
            "value":"text"
        });
        itemlist.push({
            "name":"QQ",
            "title":"QQ",
            "operator":"belong",
            "value":"text"
        });
        itemlist.push({
            "name":"address",
            "title":"通讯地址",
            "operator":"=",
            "value":"text"
        });
        itemlist.push({
            "name":"addressNum",
            "title":"邮编",
            "operator":"=",
            "value":"user"
        });

        function setValueBox(index,itemIndex){
            $("#operator"+itemIndex).val(itemlist[index]["operator"]);
            switch(itemlist[index]["value"]){
                case "text":
                    $("#valueBox"+itemIndex).html('<input type="text" name="value'+itemIndex+'" id="value'+itemIndex+'" value="" class="form-control">');
                    break;
                case "user":
                    $("#valueBox"+itemIndex).html($('<select name="value'+itemIndex+'" id="value'+itemIndex+'" class="form-control">').html($("#usertemp").html()));
                    break;
                case "pri":
                    $("#valueBox"+itemIndex).html($('<select name="value'+itemIndex+'" id="value'+itemIndex+'" class="form-control">').html($("#pritemp").html()));
                    break;
                case "status":
                    $("#valueBox"+itemIndex).html($('<select name="value'+itemIndex+'" id="value'+itemIndex+'" class="form-control">').html($("#statustemp").html()));
                    break;
                case "date":
                    $("#valueBox"+itemIndex).html('<input type="text" name="value'+itemIndex+'" id="value'+itemIndex+'" value="" class="form-control dateinput">');
                    break;
            }
        }
        $("#field1,#field2,#field3,#field4,#field5,#field6").each(function(index){
            $(this).empty();
            var option;
            for(var i=0;i<itemlist.length;i++){
                option = $("<option>").val(itemlist[i]["name"]).text(itemlist[i]["title"]);
                $(this).append(option);
            }
            $(this).val(itemlist[index]["name"]);
            $("#operator"+(index+1)).html($("#operatortemp").html());
            setValueBox(index,index+1);
            $(this).on("change",function(){
                for(var i=0;i<itemlist.length;i++){
                    if(itemlist[i]["name"]==$(this).val()){
                        setValueBox(i,$(this).attr("id").substr(-1));
                        break;
                    }
                }
            });

        });
        $("#searchform").on("click","input[class*=dateinput]",function(){
            WdatePicker({
                startDate:'%y-%M-01 00:00:00',dateFmt:"yyyy-MM-dd"
            })
        });
    });
    //-->
</script>