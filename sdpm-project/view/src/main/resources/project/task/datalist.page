#macro setTinyItemCount(num)
<input type="hidden" name="records" value="${num}"/>
#end
#include("/project/task/maplist.page")
#set(records=taskPager?.getTotalCount(),temp=1,pagesize=temp.parseInt(pagesize),page=temp.parseInt(page),pagesize=pagesize<100?pagesize:100)
#if (pagesize>records-pagesize*(page-1))
    #set(pagesize=records-(page-1)*pagesize)
#end
#setTinyItemCount(records)
#for(t:taskPager?.records)
#@tr()
    #@td()<input type="checkbox" value="${t?.taskId}" name="idCheck">#end
    #@td()<a href="${TINY_CONTEXT_PATH+adminPath}/project/task/findTask?taskId=${t?.taskId}">${t?.taskId}</a> #end
    #@td()${t?.taskPri}</a>#end
    #@td()<a href="${TINY_CONTEXT_PATH+adminPath}/project/task/findTask?taskId=${t?.taskId}">${t?.taskName}#end
    #if(t.taskStatus)
        #@td()${showStatuMap.get(t.taskStatus)}#end
    #else
        #@td()#end
    #end

    #@td()
        ${formatdate(t?.taskDeadLine,"yyyy-MM-dd")}
    #end
    #@td()
        #if(t.taskOpenedDate)
            ${formatdate(t.taskOpenedDate,"yyyy-MM-dd")}
        #end
    #end
    #@td()${t?.taskAssignedTo==null?"":UserUtils.getUserById(t?.taskAssignedTo)?.orgUserRealName}#end
    #@td()${t?.taskFinishedBy==null?"":UserUtils.getUserById(t?.taskFinishedBy)?.orgUserRealName}#end
    #@td()
        #foreach(m:menuManager.getScopeMenus("pro-task-op"))
        ##逻辑判断，根据状态判断是否可选择。
        ##1.关闭，则
            #if(t.taskStatus == 1)
                #if(m.id == "pro-task-close")
                    <span style="color:grey">#buttonIcon(iconClass=m.icon+" grey")</span>
                #else
                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?taskId=${t?.taskId}"
                       title="${m.name}">#buttonIcon(iconClass=m.icon)</a>
                #end
            #elseif(t.taskStatus == 2)
                #if(m.id == "pro-task-start" || m.id=="pro-task-close")
                    <span style="color:grey">#buttonIcon(iconClass=m.icon+" grey")</span>
                #else
                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?taskId=${t?.taskId}"
                       title="${m.name}">#buttonIcon(iconClass=m.icon)</a>
                #end
            #elseif(t.taskStatus == 3)
                #if(m.id == "pro-task-start" || m.id == "pro-task-finish")
                    <span style="color:grey">#buttonIcon(iconClass=m.icon+" grey")</span>
                #else
                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?taskId=${t?.taskId}"
                       title="${m.name}">#buttonIcon(iconClass=m.icon)</a>
                #end
            #elseif(t.taskStatus == 4)
                #if(m.id == "pro-task-start" || m.id == "pro-task-close")
                    <span style="color:grey">#buttonIcon(iconClass=m.icon+" grey")</span>
                #else
                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?taskId=${t?.taskId}"
                       title="${m.name}">#buttonIcon(iconClass=m.icon)</a>
                #end
            #elseif(t.taskStatus == 5)
                #if(m.id == "pro-task-call" || m.id == "pro-task-start" || m.id =="pro-task-finish")
                    <span style="color:grey">#buttonIcon(iconClass=m.icon+" grey")</span>
                #else
                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?taskId=${t?.taskId}"
                       title="${m.name}">#buttonIcon(iconClass=m.icon)</a>
                #end
            #elseif(t.taskStatus == 6)
                #if(m.id == "pro-task-call" || m.id == "pro-task-start" ||
                m.id =="pro-task-finish" || m.id == "pro-task-close")
                    <span style="color:grey">#buttonIcon(iconClass=m.icon+" grey")</span>
                #else
                    <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}?taskId=${t?.taskId}"
                       title="${m.name}">#buttonIcon(iconClass=m.icon)</a>
                #end
            #else
            #end
        #end
    #end
#end
#end