#@tinyForm("batchAddForm" TINY_CONTEXT_PATH+adminPath+"/project/task/consumeTime" "post" {"class":"test"})
    <input type="hidden" name="taskId" value="${task?.taskId}"/>
    #@tableBorder()
        #@thead()
            #@tr()
                #@thW("30")ID#end
                #@thW("160")日期#end
                #@thW("100")耗时#end
                #@thW("100")剩余#end
                #@thW()工作内容#end
            #end
        #end
        #@tbody()
            #set(count=systemEffortList.size())
            #foreach(s:systemEffortList)
                <tr class="this-data-row">
                    #@td()${sFor.index}#end
                    #@td()${formatDate(s.effortDate,"yyyy-MM-dd")}#end
                    #@td()${s.effortConsumed}小时#end
                    #@td()${s.effortLeft}小时#end
                    #@td()${s.effortWork}#end
                </tr>
            #end
            #set(nowDate=now())
            #foreach(i:[0..4])
                <tr class="this-data-row">
                    #@td()${count+i+1}#end
                    #@td()
                        #@tinyDateInput("list["+i+"].effortDate" formatDate(nowDate,"yyyy-MM-dd")  "YYYY-MM-DD" {"placeholder": "选择日期"})#end
                    #end
                    #@td()
                        #tinyInput("text" "list["+i+"].effortConsumed")
                    #end
                    #@td()
                        #tinyInput("text" "list["+i+"].effortLeft")
                    #end
                    #@td()
                        #tinyInput("text" "list["+i+"].effortWork")
                    #end
                </tr>
            #end
        #end
    #end

    <div class="col-12">
        <div class="col-5"></div>
        <div class="col-1">
            <input style="float: left" type="submit" id="submit2" class="commitBtn" value="保存">
        </div>
        <div class="col-1">
            #@aExtendButton("btn-sm backBtn" "javascript:history.go(-1)")取消#end
        </div>
        <div class="col-5"></div>
    </div>

#end


<script type="text/javascript">
    $(function () {
        $('form[name=batchAddForm]').Validform({
            beforeSubmit: function (form) {
                var showBreak = false;
                $(form).find("tr.this-data-row").each(function (index) {
                    var that = this;
                    var dateInput=$(that).find("input:first");
                    var dateVal = new Boolean(dateInput.val());
                    dateVal = dateVal.valueOf();
                    var hasVal = false;
                    $(that).find("input[type=text]:not(:first)").each(function (index1) {
                        var thisVal = new Boolean($(this).val());
                        thisVal=thisVal.valueOf();
                        $(this).removeClass("Validform_error");
                        dateInput.removeClass("Validform_error");
                        if(thisVal&&dateVal==false) {
                            showBreak = true;
                            dateInput.addClass("Validform_error");
                            dateInput.get(0).focus();
                            layer.msg("日期不能为空");
                            return false;
                        }
                        if (index1 == 0) {
                            hasVal = thisVal;
                        } else {
                            if (thisVal != hasVal) {
                                showBreak = true;
                                var focus=this;
                                var focusIndex=index1+2;
                               if(thisVal){
                                   focus=$(this).closest("td").prev("td").find("input").get(0);
                                   focusIndex--;
                               }
                                $(focus).addClass("Validform_error");
                                focus.focus();
                                layer.msg($(form).find("th").eq(focusIndex).html()+"不能为空");
                                return false;
                            }
                        }
                    });
                    if (showBreak) {
                        return false;
                    }
                });
                if (showBreak) {
                    return false;
                }
            }
        });
    })
</script>