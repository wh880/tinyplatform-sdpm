#!set(activeTitle="团队管理",activeMenuId=currentPageId)
#@div()
    #@tabWithInit("tab_demo" "optionsBox")
        #@div(divClass="dropdownBox")
            #include("/project/dropdownMenu.page")
        #end
        #@tabHead()
            #include("/project/protab.page")
        #end
        #@tabBodyCol("ptop-5")
            #@div(divClass="operationbar")
            团队管理
            #end
        #end
    #end
#end
#@tinyForm("thisform" TINY_CONTEXT_PATH+adminPath+"/project/team/teamManageSave" "post" {"class":"test"})
    #@table()
    <tr>
        <td width="20%">
            用户
        </td>
        <td width="20%">
            <span class="c-red">*</span>
            角色
        </td>
        <td width="20%">
            加盟日
        </td>
        <td width="20%">
            可用工日
        </td>
        <td width="20%">
            可用工时/天
        </td>
    </tr>
        #set(a = 0)
        #foreach(t : teamList)
        <tr>
            #@thW("250px")
                ${t?.teamUserId==null?"":userUtils.getUserById(t?.teamUserId)?.orgUserRealName}
                <input name="teamList[${a}].teamUserId" value="${t?.teamUserId}" type="hidden">
                <input name="teamList[${a}].id" value="${t.id}" type="hidden">
            #end
            <td>
                #@Tselect2F()
                    #@Tselect2Body(
                        "teamList["+a+"].teamRole" t.teamRole {"class":"input-text select2","multiple":"multiple"})
                        #foreach(r : roleList)
                            <option value="${r.orgRoleId}">${r.orgRoleName}</option>
                        #end
                    #end
                    #@Tselect2Fix()
                        #set(m=menuManager.getMenu("organizationAddGroup"))
                        #if(m)
                            <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}" class="r">增加</a>
                        #end
                        #set(m=menuManager.getMenu("organizationPrivilege"))
                        #if(m)
                            <a href="${TINY_CONTEXT_PATH+adminPath}${m.href}">全部</a>
                        #end
                    #end
                #end
            ##                #tinyInput("text" "teamList["+a+"].teamRole" t.teamRole {"datatype":"","class":"input-text"})
            </td>
            <td>
                #@tinyDateInput("teamList["+a+"].teamJoin" formatDate(now(),"yyyy-MM-dd") "YYYY-MM-DD" )#end
            </td>
            <td>
                #tinyInput("text" "teamList["+a+"].teamDays" t.teamDays {"datatype":"","class":"input-text"})
            </td>
            <td>
                #tinyInput("text" "teamList["+a+"].teamHours" t.teamHours {"datatype":"","class":"input-text"})
            </td>
        </tr>
            #set(a = a + 1)
        #end
        #@table("itemlist-table")
            #@tbody("databody")
                #include("addTr.page")
            #end
        #end
    <script>
        $(function () {
            function updateUserID() {
                $('.itemlist-table>.databody .userID').each(function (index) {
                    $(this).html(index + 1);
                });
            }

            $(".itemlist-table").on("click", ".addnext", function () {
                var $thisTr =
                $(this).closest("tr");
                var a = $thisTr.attr("class");
                var no = a.substr(3);
                $.ajax({
                    type: 'POST',
                    url: "${TINY_CONTEXT_PATH+adminPath}/product/team/nextTr?a=" + no,
                    dataType: "html",
                    success: function (data) {
                            $thisTr.after(data);
                    },
                });
                    $thisTr.find(".addnext").css("display","none");
//            updateUserID();
                return false;
            }).on("click", ".delbutton", function () {
                if ($('.databody .userID').size() == 1) return;
                var that = this;
                layer.confirm('确定删除?', function () {
                    $(that).closest("tr").remove();
                    updateUserID();
                    layer.msg('删除成功！', 1, 1)
                })
            });
        });
    </script>
    #end
    #@div(divClass="col-7 col-offset-5 form-inline")
        #tinyInput("submit" "submitbtn" " 保存 " {"class":"btn btn-primary"})
    <a href="javascript:history.go(-1)" class="btn radius btn-default">返回</a>
    #end

#end
