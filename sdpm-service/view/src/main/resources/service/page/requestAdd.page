#import("/org/tinygroup/button/components/button_common.component")
#import("/org/tinygroup/button/components/button.component")
#import("/org/tinygroup/table/components/table.component")
#!set(activeTitle="服务管理",activeMenuId=currentPageId)
<style>
    .select_boxes {
        margin-top: 0
    }
</style>
#set(name="request1")
#@div()
    #@tabWithInit("tab_demo" "optionsBox")
        #@div(divClass="dropdownBox")
            #include("/service/page/dropdownMenu.page")
        #end
        #@tabHead()
            #include("/service/page/tab.page")
        #end

        #@tabBodyCol("ptop-5")

        #end
        #@div(divClass="bugBox")
            #@p(pClass="title_sty")新建请求#end
            #@tinyForm("thisform" "url" "post" {"class":""})
                #@elementItem()
                    #@colLabel()产品ID：#end
                    #@formControlDiv("col-8 form-inline selectList")
                        #@tinySelect("" "" {"class":"#####","nullmsg":"请选择","datatype":"*"})
                            #@optionItem("")请选择#end
                            #@optionItem("")产品1#end
                            #@optionItem("")产品2 #end
                        #end
                    #end
                #end
                #@elementItem()
                    #@colLabel()客户ID：#end
                    #@formControlDiv("col-8")
                        #tinyInput("text" "服务协议ID" ""{"datatype":"","id":"协议ID","class":"input-text"})
                    #end
                    #@validateDiv("col-2")#end
                #end
                #@elementItem()
                    #@colLabel()请求级别：#end
                    #@formControlDiv("col-8 form-inline selectList")
                        #@tinySelect("" "" {"class":"#####","nullmsg":"请选择","datatype":"*"})
                            #@optionItem("")请选择#end
                            #@optionItem("")紧急#end
                            #@optionItem("")普通  #end
                        #end
                    #end
                #end
                #@elementItem()
                    #@colLabel()请求分类：#end
                    #@formControlDiv("col-8 form-inline selectList")
                        #@tinySelect("" "" {"class":"#####","nullmsg":"请选择","datatype":"*"})
                            #@optionItem("")请选择#end
                            #@optionItem("")请求分类1#end
                            #@optionItem("")请求分类2#end
                        #end
                    #end
                #end
                #@elementItem()
                    #@colLabel()请求期限：#end
                    #@formControlDiv("col-8")
                        #@tinyDateInput(
                            "birthday" "" "YYYY-MM-DD HH:mm:ss" {"style":"width:200px","datatype":"*","nullmsg":
                            "日期不能为空","placeholder":"yMdHmswW分别代表年月日时分秒星期周,你可以任意组合这些元素来自定义你个性化的日期格式."})#end
                    #end
                    #@validateDiv("col-2")#end
                #end
                #@elementItem()
                    #@colLabel()请求标题：#end
                    #@formControlDiv("col-8")
                        #tinyInput("text" "服务协议ID" ""{"datatype":"","id":"协议ID","class":"input-text"})
                    #end
                    #@validateDiv("col-2")#end
                #end

                #@elementItem()
                    #@colLabel()请求表述：#end
                    #@formControlDiv()
                        #@tinyueditor("contents" "contents""min-height:150px")#end
                    #end
                    #@validateDiv("col-2")#end
                #end
                #@elementItem()
                    #@colLabel()服务响应时限：#end
                    #@formControlDiv("col-8")
                        #tinyInput("text" "影响版本" "单位为小时（不含节假日）"{"datatype":"","id":"版本","class":"input-text"})
                    #end
                    #@validateDiv("col-2")#end
                #end
                #@elementItem()
                    #@colLabel()需求回访时限：#end
                    #@formControlDiv("col-8")
                        #tinyInput("text" "影响版本" "单位工作日"{"datatype":"","id":"版本","class":"input-text"})
                    #end
                    #@validateDiv("col-2")#end
                #end
                #@elementItem()
                    #@colLabel()服务工时上限：#end
                    #@formControlDiv("col-8")
                        #tinyInput("text" "影响版本" ""{"datatype":"","id":"版本","class":"input-text"})
                    #end
                    #@validateDiv("col-2")#end
                #end
                #@elementItem()
                    #@colLabel()服务请求数上限：#end
                    #@formControlDiv("col-8")
                        #tinyInput("text" "影响版本" ""{"datatype":"","id":"版本","class":"input-text"})
                    #end
                    #@validateDiv("col-2")#end
                #end
                #@elementItem()
                    #@colLabel()服务专员：#end
                    #@formControlDiv("col-8")
                        #tinyInput("text" "影响版本" "可以多人，间隔符英文,"{"datatype":"","id":"版本","class":"input-text"})
                    #end
                    #@validateDiv("col-2")#end
                #end
                #@elementItem()
                    #@colLabel()服务工时上限：#end
                    #@formControlDiv("col-8")
                        #tinyInput("text" "影响版本" ""{"datatype":"","id":"版本","class":"input-text"})
                    #end
                    #@validateDiv("col-2")#end
                #end#
                #@elementItem()
                    #@colLabel()创建时间：#end
                    #@formControlDiv("col-8")
                        #@tinyDateInput(
                            "birthday" "" "YYYY-MM-DD HH:mm:ss" {"style":"width:200px","datatype":"*","nullmsg":
                            "日期不能为空","placeholder":"yMdHmswW分别代表年月日时分秒星期周,你可以任意组合这些元素来自定义你个性化的日期格式."})#end
                    #end
                    #@validateDiv("col-2")#end
                #end
                #@divCenterAlign()#buttonRadiusDefault(caption="保存")
                    #buttonRadiusDefault(caption="取消")#end
            #end
        #end


    ##toggle end
    #end
##tab end
#end


<script type="text/javascript">
    $(function () {
        $(".selectList").each(function () {
            var url = "#link('/getDist.html')";
            var areaJson;
            var temp_html;
            var oProvince = $(this).find(".province");
            var oCity = $(this).find(".city");
            var oDistrict = $(this).find(".district");
            //初始化省
            var province = function () {
                $.each(areaJson, function (i, province) {
                    temp_html += "<option value='" + province.p + "'>" + province.p + "</option>";
                });
                oProvince.html(temp_html);
                city();
            };
            //赋值市
            var city = function () {
                temp_html = "";
                var n = oProvince.get(0).selectedIndex;
                $.each(areaJson[n].c, function (i, city) {
                    temp_html += "<option value='" + city.ct + "'>" + city.ct + "</option>";
                });
                oCity.html(temp_html);
                district();
            };
            //赋值县
            var district = function () {
                temp_html = "";
                var m = oProvince.get(0).selectedIndex;
                var n = oCity.get(0).selectedIndex;
                if (typeof(areaJson[m].c[n].d) == "undefined") {
                    oDistrict.css("display", "none");
                } else {
                    oDistrict.css("display", "inline");
                    $.each(areaJson[m].c[n].d, function (i, district) {
                        temp_html += "<option value='" + district.dt + "'>" + district.dt + "</option>";
                    });
                    oDistrict.html(temp_html);
                }
                ;
            };
            //选择省改变市
            oProvince.change(function () {
                city();
            });
            //选择市改变县
            oCity.change(function () {
                district();
            });
            //获取json数据
            $.getJSON(url, function (data) {
                areaJson = data;
                province();
            });
        });
    });
    $(function () {

        $("form[name=thisform").attr("action", '#link("/Validform_post.html")');
        $("form[name=thisform").Validform({
            tiptype: 2,
            usePlugin: {
                //datepicker:{},//日期控件校验;
                passwordstrength: {
                    minLen: 6,//设置密码长度最小值，默认为0;
                    maxLen: 18,//设置密码长度最大值，默认为30;
                    trigger: function (obj, error) {
                        //该表单元素的keyup和blur事件会触发该函数的执行;
                        //obj:当前表单元素jquery对象;
                        //error:所设密码是否符合验证要求，验证不能通过error为true，验证通过则为false;
                        //console.log(error);
                        if (error) {
                            obj.parent().find(".Validform_checktip").show();
                            obj.parent().find(".passwordStrength").hide();
                        } else {
                            obj.parent().find(".passwordStrength").show();
                        }
                    }
                }
            },
            ajaxPost: true,
            beforeCheck: function (curform) {
                //在表单提交执行验证之前执行的函数，curform参数是当前表单对象。
                //这里明确return false的话将不会继续执行验证操作;
            },
            beforeSubmit: function (curform) {
                //在验证成功后，表单提交前执行的函数，curform参数是当前表单对象。
                //这里明确return false的话表单将不会提交;
            },
            callback: function (data) {
                if (data.status == "y") {
                    setTimeout(function () {
                        $.Hidemsg(); //公用方法关闭信息提示框;显示方法是$.Showmsg("message goes here.");
                    }, 2000);
                }
                //返回数据data是json对象，{"info":"demo info","status":"y"}
                //info: 输出提示信息;
                //status: 返回提交数据的状态,是否提交成功。如可以用"y"表示提交成功，"n"表示提交失败，在Validform_post.html文件返回数据里自定字符，主要用在callback函数里根据该值执行相应的回调操作;
                //你也可以在Validform_post.html文件返回更多信息在这里获取，进行相应操作；
                //ajax遇到服务端错误时也会执行回调，这时的data是{ status:**, statusText:**, readyState:**, responseText:** }；

                //这里执行回调操作;
                //注意：如果不是ajax方式提交表单，传入callback，这时data参数是当前表单对象，回调函数会在表单验证全部通过后执行，然后判断是否提交表单，如果callback里明确return false，则表单不会提交，如果return true或没有return，则会提交表单。
            }
        });
    });
</script>
<script type="text/javascript">
    $(".select2").select2();
</script>


