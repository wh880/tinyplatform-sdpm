#import("/org/tinygroup/button/components/button_common.component")
#import("/org/tinygroup/button/components/button.component")
#import("/org/tinygroup/table/components/table.component")
#!set(activeTitle="服务管理",activeMenuId=currentPageId)
<style>
    .select_boxes {
        margin-top: 0
    }
</style>
#set(name="request")
#@div()
    #@tabWithInit("tab_demo" "optionsBox")
        #@tabHead()
            #include("/service/serviceCom/tab.page")
        #end
    <br>
    #end
#end
#@tinyForm("thisform" TINY_CONTEXT_PATH+"/service/request/save" "post" {"class":""})
<div style="width:80%;margin-left: 20px;" class="pageleftpart">
    <div class="infoContent">
        <p class="titleName">请求</p>
        <input type="hidden" name="clientRequestId" value="${request?.clientRequestId}"/>
        #@elementItem()
            #@sdpmItem("产品名称")
                #@Tselect2F()
                    #@Tselect2Body(
                        "productId" request?.productId {"placeholder":"产品名称","datatype":"*","nullmsg":"请求标题不能为空！","id":
                        "request_title", "class":"input-text select2"})  ##,"multiple":"multiple"加上为多选项
                        #@tinyOptionItem("")请选择#end
                        #@tinyOptionItem("1")支付宝#end
                        #@tinyOptionItem("2")余额宝#end
                        #@tinyOptionItem("3")财付通#end
                    #end
                ##                    #@Tselect2Fix()<a href="${TINY_CONTEXT_PATH}/service/sla/slaAdd.page" class="r ">增加</a><a
                ##                            href="${TINY_CONTEXT_PATH}/service/sla/sla.page">全部</a>#end
                #end
            #end
        #end
        #@elementItem()
            #@sdpmItem("请求类型" "*")
                #@Tselect2F()
                    #@Tselect2Body(
                        "requestType" request?.requestType {"placeholder":"请求类型","datatype":"*","nullmsg":"请求类型不能为空！",
                        "id":
                        "request_title", "class":"input-text select2"}) ##,"multiple":"multiple"加上为多选项
                        #@tinyOptionItem("")请选择#end
                        #@tinyOptionItem("0")缺陷#end
                        #@tinyOptionItem("1")适应性#end
                        #@tinyOptionItem("2")完善#end
                        #@tinyOptionItem("3")个性化#end
                        #@tinyOptionItem("4")全新#end
                        #@tinyOptionItem("5")训练#end
                        #@tinyOptionItem("6")支持#end
                        #@tinyOptionItem("7")疑惑#end
                    #end
                #end
            #end
        #end
        #@elementItem()
            #@sdpmItem("请求优先级" "*")
                #@Tselect2F()
                    #@Tselect2Body(
                        "requestPre" request?.requestPre {"placeholder":"请求优先级","datatype":"*","nullmsg":"请求优先级不能为空！",
                        "id":
                        "request_title", "class":"input-text select2"}) ##,"multiple":"multiple"加上为多选项
                        #@tinyOptionItem("")请选择#end
                        #@tinyOptionItem("0")低#end
                        #@tinyOptionItem("1")中#end
                        #@tinyOptionItem("2")高#end
                    #end
                #end
            #end
        #end
        #@elementItem()
            #@sdpmItem("请求模块")
                #@Tselect2F()
                    #@Tselect2Body(
                        "moduleId" request?.moduleId {"class":"input-text select2"}) ##,"multiple":"multiple"加上为多选项
                        #@tinyOptionItem("")请选择#end
                        #@tinyOptionItem("2")模块一#end
                        #@tinyOptionItem("3")模块二#end
                        #@tinyOptionItem("4")模块三#end
                    #end
                #end
            #end
        #end

        #@elementItem()
            #@sdpmItem("客户名称" "*")
                #@Tselect2F()
                    #@Tselect2Body(
                        "clientId" request?.clientId {"placeholder":"客户名称","datatype":"*","nullmsg":"客户名称不能为空！","id":
                        "request_title", "class":"input-text select2"}) ##,"multiple":"multiple"加上为多选项
                        #@tinyOptionItem("")请选择#end
                        #foreach(l:list)
                            #@tinyOptionItem(l.clientId)${l?.clientName}#end
                        #end
                    #end
                #end
            #end
        #end
        #@elementItem()
            #@sdpmItem("客户联系人" "*")
                #tinyInput(
                    "text" "requester" request?.requester{"placeholder":"请输入客户联系人","datatype":"*","nullmsg":
                    "客户联系人不能为空！",
                    "id":"request_title","class":"input-text"})
            #end
        #end

        #@elementItem()
            #@sdpmItem("请求标题" "*")
                #tinyInput(
                    "text" "requestTitle" request?.requestTitle{"placeholder":"请求标题","datatype":"*","nullmsg":
                    "请求标题不能为空！","id":
                    "request_title", "class":"input-text select2"})
            #end
        #end

        #@elementItem()
            <div class="col-12">
                <div class="col-2 text-r"><label>请求描述：</label></div>
                <div class="col-9">
                    #@Teditor("content" "requestSpec" {"initialFrameHeight":"280"})${request?.requestSpec}#end</div>
            </div>
        #end
        #@elementItem()
            #@sdpmItem("请求状态" "*")
                #@Tselect2F()
                    #@Tselect2Body(
                        "requestStatus" request?.requestStatus {"placeholder":"请求状态","datatype":"*","nullmsg":
                        "请求状态不能为空！","id":
                        "request_title", "class":"input-text select2"}) ##,"multiple":"multiple"加上为多选项
                        #@tinyOptionItem("")请选择#end
                        #@tinyOptionItem("0")新建#end
                        #@tinyOptionItem("6")待回访#end
                        #@tinyOptionItem("8")已回访#end
                        #@tinyOptionItem("2")被拒绝#end
                        #@tinyOptionItem("1")处理中#end
                    #end
                #end
            #end
        #end
        #@elementItem()
            #@sdpmItem("请求提交时间" "*")
                #@tinyDateInput(
                    "requestSubmitDate" formatDate(request?.requestSubmitDate,
                    "yyyy-MM-dd") "YYYY-MM-DD" {"style":"width:200px","datatype":"*",
                "nullmsg":"日期不能为空","placeholder":"请输入日期"})#end
            #end
        #end
        #@elementItem()
            #@sdpmItem("请求承诺回复时间")
                #@tinyDateInput("requestCommitmentDate" formatDate(request?.requestCommitmentDate,
                    "yyyy-MM-dd") "YYYY-MM-DD" {"style":"width:200px","datatype":""})#end
            #end
        #end


        <br/>
    </div>
##           /*************保存
    #@elementItem()
        <div class="col-12">
            <div class="col-5">

            </div>
            <div class="col-1">
                <button style="float: left" type="submit" id="submit" class="commitBtn">保存</button>
            </div>
            <div class="col-1">
                #@aExtendButton("btn-sm backBtn" "javascript:history.go(-1)")返回#end
            </div>
            <div class="col-5"></div>
        </div>
    #end
    <br>
</div>

#end

<script type="text/javascript">
    $("select.select2").select2();
</script>
<script type="text/javascript">
    $(function () {
        $("form[name=thisform").Validform({
            tiptype: 2,
            usePlugin: {
                //datepicker:{},//日期控件校验;
                passwordstrength: {
                    minLen: 6,//设置密码长度最小值，默认为0;
                    maxLen: 18,//设置密码长度最大值，默认为30;
                    trigger: function (obj, error) {
                        //该表单元素的keyup和blur事件会触发该函数的执行;
                        //obj:当前表单元素jquery对象;
                        //error:所设密码是否符合验证要求，验证不能通过error为true，验证通过则为false;
                        //console.log(error);
                        if (error) {
                            obj.parent().find(".Validform_checktip").show();
                            obj.parent().find(".passwordStrength").hide();
                        } else {
                            obj.parent().find(".passwordStrength").show();
                        }
                    }
                }
            },
            //ajaxPost:true,
            beforeCheck: function (curform) {
                //在表单提交执行验证之前执行的函数，curform参数是当前表单对象。
                //这里明确return false的话将不会继续执行验证操作;
            },
            beforeSubmit: function (curform) {
                $(curform).ajaxSubmit({
                    dataType: "json",
                    success: function (data) {
                        if (data.status == "y") {
                            layer.msg(data.info, 2, -1);
                        } else {
                            layer.msg(data.info);
                        }
                        try {
                            $(curform).parents(".modal:first").find(".modal-header .close").trigger("click");//弹出框关闭
                            $("table.tinytable").trigger("initnav"); ////可配合TINYTABLE 做刷新
                        } catch (e) {
                        }
                    },
                    error: function () {
                        layer.msg(data.info);
                    }
                });
                return false;

                //在验证成功后，表单提交前执行的函数，curform参数是当前表单对象。
                //这里明确return false的话表单将不会提交;
            }
        });
    });
</script>

