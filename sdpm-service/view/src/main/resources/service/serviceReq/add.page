<script type="text/javascript">
    function ajaxRead(id, toName, opKey, opvalue, url, value) {
        var selectCheck = "select[name=" + toName + "]";
        $(selectCheck).each(function () {
            var sele = $(this);
            var s;
            $.ajax({
                type: "POST",
                url: "${TINY_CONTEXT_PATH+adminPath}" + url,
                data: $(this).attr('data'),
                dataType: "json",
                success: function (data) {
                    sele.empty();
                    var em = "<option value='0'>/</option>";
                    sele.append(em);
                    var isInit = false;
                    for (var i = 0, l = data.length; i < l; i++) {
                        if (data[i][opKey] == value) isInit = true;
                        var em = "<option value='" + data[i][opKey] + "' >" + data[i][opvalue] + "</option>";
                        sele.append(em);
                    }
                    //console.log(sele.html(),value,opKey);
                    if (isInit) {
                        sele.val(value).trigger("change");
                    } else {
                        sele.val("0").trigger("change");
                    }
                },
            });
        });
    }
</script>

#import("/org/tinygroup/button/components/button_common.component")
#import("/org/tinygroup/button/components/button.component")
#import("/org/tinygroup/table/components/table.component")
#!set(activeTitle="服务管理",activeMenuId=currentPageId)
<style>
    .select_boxes {
        margin-top: 0
    }
</style>
#set(name="request")
#@div()
    #@tabWithInit("tab_demo" "optionsBox")
        #@tabHead()
            #include("/service/serviceCom/tab.page")
        #end
    <br>
    #end
#end
#@tinyForm("thisform" TINY_CONTEXT_PATH+adminPath+"/service/request/save" "post" {"class":""})
<div style="width:80%;margin-left: 20px;" class="pageleftpart">
    <div class="infoContent">
        <p class="titleName">请求</p>
        <input type="hidden" name="clientRequestId" value="${request?.clientRequestId}"/>
        #@elementItem()
            #@sdpmItem("产品名称","*")
                #@Tselect2F()
                    #@Tselect2Body(
                        "productId" request?.productId {"placeholder":"产品名称","datatype":"*","nullmsg":"产品名称不能为空！",
                        "class":"input-text select2"})  ##,"multiple":"multiple"加上为多选项
                        #@tinyOptionItem("")请选择#end
                        #foreach(l:productList)
                            #@tinyOptionItem(l.productId)${l?.productName}#end
                        #end
                        <script type="text/javascript">
                            $("#${sid}").on("change", function () {
                                var pId = $(this).val();
                                ajaxRead("${sid}", "moduleId", "moduleId", "moduleName", "/service/request/ajax/moduleByProduct?productId="+pId,${request?.moduleId?:0});
                            })
                </script>
                #end

                #end
            #end
        #end
        #@elementItem()
            #@sdpmItem("请求类型" "*")
                #@Tselect2F()
                    #@Tselect2Body(
                        "requestType" request?.requestType {"placeholder":"请求类型","datatype":"*","nullmsg":"请求类型不能为空！",
                        "class":"input-text select2"}) ##,"multiple":"multiple"加上为多选项
                        #@tinyOptionItem("")请选择#end
                        #foreach(item : getDict("requestType"))
                            #@tinyOptionItem(item.value)${item.text}#end
                        #end
                    #end
                #end
            #end
        #end
        #@elementItem()
            #@sdpmItem("请求优先级" "*")
                #@Tselect2F()
                    #@Tselect2Body(
                        "requestPre" request?.requestPre {"placeholder":"请求优先级","datatype":"*","nullmsg":"请求优先级不能为空！",
                        "class":"input-text select2"}) ##,"multiple":"multiple"加上为多选项
                        #@tinyOptionItem("")请选择#end
                        #foreach(item : getDict("requestPre"))
                            #@tinyOptionItem(item.value)${item.text}#end
                        #end
                    #end
                #end
            #end
        #end
        #@elementItem()
            #@sdpmItem("请求模块")
                #@Tselect2F()
                    #@Tselect2Body("moduleId" request?.moduleId {"class":"input-text select2"})#end

                #end
            #end
        #end

        #@elementItem()
            #@sdpmItem("客户名称" "*")
                #@Tselect2F()
                    #@Tselect2Body(
                        "clientId" request?.clientId {"placeholder":"客户名称","datatype":"*","nullmsg":"客户名称不能为空！","class":
                        "input-text select2"}) ##,"multiple":"multiple"加上为多选项
                        #@tinyOptionItem("")请选择#end
                        #foreach(l:clientList)
                            #@tinyOptionItem(l.clientId)${l?.clientName}#end
                        #end
                    #end
                #end
            #end
        #end
        #@elementItem()
            #@sdpmItem("客户联系人" "*")
                #tinyInput(
                    "text" "requester" request?.requester{"placeholder":"请输入客户联系人","datatype":"*","nullmsg":
                    "客户联系人不能为空！","class":"input-text"})
            #end
        #end

        #@elementItem()
            #@sdpmItem("请求标题" "*")
                #tinyInput(
                    "text" "requestTitle" request?.requestTitle{"placeholder":"请求标题","datatype":"*","nullmsg":
                    "请求标题不能为空！","class":"input-text select2"})
            #end
        #end

        #@elementItem()
            <div class="col-12">
                <div class="col-2 text-r"><label>请求描述：</label></div>
                <div class="col-9">
                    #@Teditor("content" "requestSpec" {"initialFrameHeight":"280"})${request?.requestSpec}#end</div>
            </div>
        #end
        #@elementItem()
            #@sdpmItem("请求状态" "*")
                #@Tselect2F()
                    #@Tselect2Body(
                        "requestStatus" request?.requestStatus {"placeholder":"请求状态","datatype":"*","nullmsg":
                        "请求状态不能为空！","class":"input-text select2"}) ##,"multiple":"multiple"加上为多选项
                        #@tinyOptionItem("")请选择#end
                        #foreach(item : getDict("requestStatus"))
                            #@tinyOptionItem(item.value)${item.text}#end
                        #end
                    #end
                #end
            #end
        #end
        #@elementItem()
            #@sdpmItem("请求提交时间" "*")
                #@tinyDateInput(
                    "requestSubmitDate" formatDate(request?.requestSubmitDate?:now(),
                "yyyy-MM-dd") "YYYY-MM-DD" {"style":"width:120px","datatype":"*",
                "nullmsg":"日期不能为空","placeholder":"请输入日期"})#end
            #end
        #end
        #@elementItem()
            #@sdpmItem("请求承诺回复时间")
                #@tinyDateInput("requestCommitmentDate" formatDate(request?.requestCommitmentDate,
                    "yyyy-MM-dd") "YYYY-MM-DD" {"style":"width:120px"})#end
            #end
        #end


        <br/>
    </div>
##           /*************保存
    #@elementItem()
        <div class="col-12">
            <div class="col-5">

            </div>
            <div class="col-1">
                <button style="float: left" type="submit" id="submit" class="commitBtn">保存</button>
            </div>
            <div class="col-1">
                #@aExtendButton("btn-sm backBtn" "javascript:history.go(-1)")返回#end
            </div>
            <div class="col-5"></div>
        </div>
    #end
    <br>
</div>

#end

<script type="text/javascript">
    $("select.select2").select2();
</script>
<script type="text/javascript">
    $(function () {
        $("form[name=thisform").Validform({
            tiptype: 2

        });
    });
</script>

