#!set(activeTitle="角色管理",activeMenuId=currentPageId,parentId=parentId?:"0")
#import("/common/component/form.component")

#set(name="organizationPrivilege")
#@div()
    #@tabWithInit("tab_demo" "optionsBox")
        #@tabHead()
            #include("/organization/common/tab.page")
        #end
        #@tabBodyCol("ptop-5")
            #@div(divClass="operationbar")
            <span style="float:left">
                <a href="${TINY_CONTEXT_PATH+adminPath}/org/roleMenu/show?parentId=0&id=${id}" ${parentId=='0'?" class='active_btn'":""}>所有权限</a>
                #foreach(root:menuManager.getChildMenus)
                    <a href="${TINY_CONTEXT_PATH+adminPath}/org/roleMenu/show?parentId=${root.id}&id=${id}" ${parentId=='root.id'?" class='active_btn'":""}>${root.name}</a>
                #end
##                <a href="${TINY_CONTEXT_PATH+adminPath}/org/roleMenu/show?parentId=productLine&id=${id}" ${parentId=='productLine'?" class='active_btn'":""}>产品线</a>
##                <a href="${TINY_CONTEXT_PATH+adminPath}/org/roleMenu/show?parentId=myproduct&id=${id}" ${parentId=='myproduct'?" class='active_btn'":""}>产品</a>
##                <a href="${TINY_CONTEXT_PATH+adminPath}/org/roleMenu/show?parentId=project&id=${id}" ${parentId=='project'?" class='active_btn'":""}>迭代</a>
##                <a href="${TINY_CONTEXT_PATH+adminPath}/org/roleMenu/show?parentId=quality&id=${id}" ${parentId=='quality'?" class='active_btn'":""}>测试</a>
##                <a href="${TINY_CONTEXT_PATH+adminPath}/org/roleMenu/show?parentId=idocument&id=${id}" ${parentId=='idocument'?" class='active_btn'":""}>文档</a>
##                <a href="${TINY_CONTEXT_PATH+adminPath}/org/roleMenu/show?parentId=statistic&id=${id}" ${parentId=='statistic'?" class='active_btn'":""}>统计</a>
##                <a href="${TINY_CONTEXT_PATH+adminPath}/org/roleMenu/show?parentId=service&id=${id}" ${parentId=='service'?" class='active_btn'":""}>客服</a>
##                <a href="${TINY_CONTEXT_PATH+adminPath}/org/roleMenu/show?parentId=organization&id=${id}" ${parentId=='organization'?" class='active_btn'":""}>组织</a>
##                <a href="${TINY_CONTEXT_PATH+adminPath}/org/roleMenu/show?parentId=mysystem&id=${id}" ${parentId=='mysystem'?" class='active_btn'":""}>系统</a>
            </span>
                #div(divClass="clearfix")
            #end
        #end
    #end
#end
<style>
    .group-check-list li {
        width: 160px;
        float: left
    }

    .group-check-list {
        border-top: 1px solid #eee;
    }

    .form .row.group-check-list {
        margin: 0
    }

    .group-check-list > div {
        padding: 15px;
    }

    .group-check-list > div:first-child {
        text-align: right;
    }

    .group-check-list > div:last-child {
        border-left: 1px solid #eee;
    }
</style>
#@tinyForm("thisform" call("link",adminPath+"/org/roleMenu/save") "post")
    #@Tcheckboxes("menuId" orgRoleMenuIdList {"nullmsg":"请选择角色应有的菜单！","datatype":""})
        #foreach(m:menuManager.getChildMenus("0"))
        <div class="row group-check-list">
            <div class="col-2">#@Tcheckbox(m.id {"data-targetGroup":"g"+m.id})${m.name}#end</div>
            <div class="col-10">
                <ul>
                    #foreach(m2:menuManager.getAllChildMenusWithoutParent(m.id))
                        <li>#@Tcheckbox(m2.id {"data-group":"g"+m.id})${m2.name}#end</li>
                    #end
                </ul>
                <div class="clear"></div>
            </div>
        </div>
        #end
    #end
#end
<script type="text/javascript">
    $(function () {
        $("input[data-targetgroup]").click(function () {
            var check = "uncheck";
            var gid = $(this).attr("data-targetgroup");
            if (this.checked) {
                check = "check";
            }
            $("input[data-group=" + gid + "]").iCheck(check);
        })
    })
</script>
##
###@noRespsGridSystem()
##    #@gridSysRow()
##        #@gridSysCol(3)
##        #end
##        #@gridSysCol(6)
##            #@gridSysRow()
##            <ul id="treeDemo" class="ztree" style="width:100%;min-height:360px;max-height:300px;"></ul>
##            <div style="padding-top: 20px;float: right">
##                #@div(divClass="col-7 col-offset-5 form-inline")
##                        #tinyInput("submit" "submitbtn" " 提交 " {"class":"btn btn-primary"})
##                    #end
##            </div>
##            #end
##        #end
##        #@gridSysCol(3)
##        #end
##
##    #end
###end
##
##<SCRIPT type="text/javascript">
##    <!--
##    var setting = {
##        check: {
##            enable: true
##        },
##        data: {
##            simpleData: {
##                enable: true
##            }
##        }
##    };
##
##    var zNodes = [];
##        #foreach(m:menuManager.getAllChildMenus(parentId))
##        zNodes.push({
##            id: '${m.id}',
##            pId: '${m.parentId}',
##            name: "${m.name}",
##            open: true,
##            checked: ${orgRoleMenus.contains(m.id)? 'true' : 'false'
##        }
##        });
##        #end
##
##
##    $(document).ready(function () {
##        var $ztree=
##        $.fn.zTree.init($("#treeDemo"), setting, zNodes);
##        $("input[name=submitbtn]").on("click", function () {
##            var nodes =$ztree.getCheckedNodes(true);
##            var checkarr = [];
##            for (var i = 0, l = nodes.length; i < l; i++) {
##                checkarr.push(nodes[i].id);
##            }
##            $.ajax({
##                url: "${TINY_CONTEXT_PATH+adminPath}/org/roleMenu/save",
##                type: "post",
##                traditional: true,
##                data: {ids: checkarr, id:${id}},
##                dataType: "json",
##                success: function (data) {
##                    if (data.status == "y") {
##                        layer.msg(data.info, 2, 1, function () {
##                            window.location.href = load;
##                        })
##                    } else {
##                        layer.msg(data.info)
##                    }
##                }
##            })
##        })
##
##    });
##    //-->
##</SCRIPT>
##
##
