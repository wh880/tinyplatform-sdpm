#!set(activeTitle="组织管理",activeMenuId=currentPageId,treeid=treeid?:"0")

#import("/common/component/form.component")

<style>
    .tabLayout .tabBar span a {
        color: #333
    }

    .tabLayout .tabBar .Current a {
        color: #fff
    }

    .operationbar {
        border-top: none;
        background: #f9fafe;
        padding: 6px 5px 6px 10px;
    }
</style>
#set(name="organizationPrivilege")

#@div()
    #@tabWithInit("tab_demo" "optionsBox")
        #@tabHead()
            #include("/organization/common/tab.page")
        #end
        #@tabBodyCol("ptop-5")

            #@div(divClass="operationbar")
            <span style="padding-top:5px;float:left">

                <a href="${TINY_CONTEXT_PATH}/org/roleMenu/show?treeid=0&id=${id}" ${treeid=='0'?" class='active_btn'":""}>所有权限</a>
                <a href="${TINY_CONTEXT_PATH}/org/roleMenu/show?treeid=home&id=${id}" ${treeid=='home'?" class='active_btn'":""}>我的地盘</a>
                <a href="${TINY_CONTEXT_PATH}/org/roleMenu/show?treeid=productLine&id=${id}" ${treeid=='productLine'?" class='active_btn'":""}>产品线</a>
                <a href="${TINY_CONTEXT_PATH}/org/roleMenu/show?treeid=myproduct&id=${id}" ${treeid=='myproduct'?" class='active_btn'":""}>产品</a>
                <a href="${TINY_CONTEXT_PATH}/org/roleMenu/show?treeid=project&id=${id}" ${treeid=='project'?" class='active_btn'":""}>迭代</a>
                <a href="${TINY_CONTEXT_PATH}/org/roleMenu/show?treeid=quality&id=${id}" ${treeid=='quality'?" class='active_btn'":""}>测试</a>
                <a href="${TINY_CONTEXT_PATH}/org/roleMenu/show?treeid=idocument&id=${id}" ${treeid=='idocument'?" class='active_btn'":""}>文档</a>
                <a href="${TINY_CONTEXT_PATH}/org/roleMenu/show?treeid=statistic&id=${id}" ${treeid=='statistic'?" class='active_btn'":""}>统计</a>
                <a href="${TINY_CONTEXT_PATH}/org/roleMenu/show?treeid=service&id=${id}" ${treeid=='service'?" class='active_btn'":""}>客服</a>
                <a href="${TINY_CONTEXT_PATH}/org/roleMenu/show?treeid=organization&id=${id}" ${treeid=='organization'?" class='active_btn'":""}>组织</a>
                <a href="${TINY_CONTEXT_PATH}/org/roleMenu/show?treeid=mysystem&id=${id}" ${treeid=='mysystem'?" class='active_btn'":""}>系统</a>
         </span>
                #@tinyForm("thisform" "" "" {"class":"test"})
                    #@formControlDiv("col-2")
                        #@tinySelect("lang" "修改历史" {"class":"input-text select2","rel":"22"})
                            #@tinyOptionItem("修改历史")修改历史#end
                            #@tinyOptionItem("zh")版本1.0#end
                            #@tinyOptionItem("en")版本2.0#end
                            #@tinyOptionItem("ta")版本3.0#end
                        #end
                    #end
                #end
                #div(divClass="clearfix")
            #end
        #end
    #end
#end


#@noRespsGridSystem()
    #@gridSysRow()
        #@gridSysCol(3)
        #end
        #@gridSysCol(6)
            #@gridSysRow()
            <ul id="treeDemo" class="ztree" style="width:100%;min-height:360px;max-height:300px;"></ul>

            <div style="padding-top: 20px;float: right">
                #@div(divClass="col-7 col-offset-5 form-inline")
                        #tinyInput("submit" "submitbtn" " 提交 " {"class":"btn btn-primary"})
                    #end
            </div>


            #end

        #end
        #@gridSysCol(3)
        #end

    #end
#end



<SCRIPT type="text/javascript">
    <!--
    var setting = {
        check: {
            enable: true
        },
        data: {
            simpleData: {
                enable: true
            }
        }
    };

    var zNodes = [];
        #foreach(m:menuManager.getAllChildMenus(treeid))
        zNodes.push({
            id: '${m.id}',
            pId: '${m.parentId}',
            name: "${m.name}",
            open: true,
            checked: ${orgRoleMenus.contains(m.id)? 'true' : 'false'
        }
        })
        ;
        #end


    $(document).ready(function () {
        var $ztree=
        $.fn.zTree.init($("#treeDemo"), setting, zNodes);
        $("input[name=submitbtn]").on("click", function () {
            var nodes =$ztree.getCheckedNodes(true);
            var checkarr = [];
            for (var i = 0, l = nodes.length; i < l; i++) {
                checkarr.push(nodes[i].id);
            }
            $.ajax({
                url: "${TINY_CONTEXT_PATH}/org/roleMenu/save",
                type: "post",
                traditional: true,
                data: {ids: checkarr, id:${id}},
                dataType: "json",
                success: function (data) {
                    if (data.status == "y") {
                        layer.msg(data.info, 2, 1, function () {
                            window.location.href = "${TINY_CONTEXT_PATH}/org/privilege/list"
                        })
                        // window.location.href="/"
                    } else {
                        layer.msg(data.info)
                    }
                }
            })
        })

    });
    //-->
</SCRIPT>


